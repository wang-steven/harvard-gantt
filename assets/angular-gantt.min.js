/*! angular-gantt 16-09-2014 */
var gantt=angular.module("gantt",["underscore","ui.tree"]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos",function(a,b,c,d,e){var f="";return{restrict:"EA",replace:!0,link:function(a,b,c){f=c.serverLocation+c.jsLocationPrefix+"/template/"},templateUrl:function(a,b){return void 0===b.templateUrl?f+"gantt.tmpl.html":b.templateUrl},scope:{sortMode:"=?",viewScale:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowTaskRowSwitching:"=?",allowRowSorting:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",maxHeight:"=?",labelsWidth:"=?",showTooltips:"=?",data:"=?",filterData:"=?",disable:"=?",serverConfig:"&",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onLabelsResized:"&",onLabelClicked:"&",onLabelDblClicked:"&",onLabelContextClicked:"&",onLabelHeaderClicked:"&",onLabelHeaderDblClicked:"&",onLabelHeaderContextClicked:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowDblClicked:"&",onRowContextClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&",onTaskDblClicked:"&",onTaskContextClicked:"&",onTaskUpdated:"&",onTaskMoveBegin:"&",onTaskMoveEnd:"&",onTaskResizeBegin:"&",onTaskResizeEnd:"&"},controller:["$scope","$http","$element","$timeout",function(f,g,h,i){return void 0===f.sortMode&&(f.sortMode="name"),void 0===f.viewScale&&(f.viewScale="day"),void 0===f.columnWidth&&(f.columnWidth=8),void 0===f.columnSubScale&&(f.columnSubScale=6),void 0===f.allowTaskMoving&&(f.allowTaskMoving=!0),void 0===f.allowTaskResizing&&(f.allowTaskResizing=!0),void 0===f.allowTaskRowSwitching&&(f.allowTaskRowSwitching=!0),void 0===f.allowRowSorting&&(f.allowRowSorting=!0),void 0===f.firstDayOfWeek&&(f.firstDayOfWeek=1),void 0===f.weekendDays&&(f.weekendDays=[0,6]),void 0===f.showWeekends&&(f.showWeekends=!0),void 0===f.workHours&&(f.workHours=[8,9,10,11,12,13,14,15,16]),void 0===f.showNonWorkHours&&(f.showNonWorkHours=!0),void 0===f.maxHeight&&(f.maxHeight=0),void 0===f.autoExpand&&(f.autoExpand=!1),void 0===f.labelsWidth&&(f.labelsWidth=0),void 0===f.showTooltips&&(f.showTooltips=!0),void 0===f.disable&&(f.disable=!1),void 0===f.serverConfig?!1:(f.ajaxUrl=f.serverConfig(),f.gantt=new a(f.viewScale,f.columnWidth,f.columnSubScale,f.firstDayOfWeek,f.weekendDays,f.showWeekends,f.workHours,f.showNonWorkHours),f.ganttHeader=h.children()[1],f.ganttScroll=angular.element(h.children()[2]),f.gantt.ajaxUrl=f.ajaxUrl,f.gantt.disable=f.disable,f.$watch("sortMode",function(a,b){angular.equals(a,b)||f.sortRows()}),f.$watch("data",function(a,b){angular.equals(a,b)||(f.removeAllData(),f.setData(a));for(var c in f.gantt.processesMap)if(f.gantt.processesMap[c].previous.length>0)for(var d=0,e=f.gantt.processesMap[c].previous.length;e>d;d++){var g=f.gantt.processesMap[c].previous[d];g in f.gantt.processesMap&&f.gantt.processesMap[g].addNext([f.gantt.processesMap[c].id])}}),f.$watch("viewScale+columnWidth+columnSubScale+fromDate+toDate+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(a,b){angular.equals(a,b)||(f.gantt.setViewScale(f.viewScale,f.columnWidth,f.columnSubScale,f.firstDayOfWeek,f.weekendDays,f.showWeekends,f.workHours,f.showNonWorkHours),f.gantt.reGenerateColumns()||f.gantt.expandDefaultDateRange(f.fromDate,f.toDate))}),f.$watch("fromDate+toDate",function(a,c){angular.equals(a,c)||(f.gantt.defaultDateRange={from:b.clone(f.fromDate),to:b.clone(f.toDate)},f.gantt.expandDefaultDateRange(f.fromDate,f.toDate))}),f.getPxToEmFactor=function(){return f.ganttScroll.children()[0].offsetWidth/f.gantt.width},f.swapRows=function(a,b){f.gantt.swapRows(a,b),f.raiseRowUpdatedEvent(a,!0),f.raiseRowUpdatedEvent(b,!0),"custom"!==f.sortMode?f.sortMode="custom":f.sortRows()},f.sortRows=function(){f.gantt.sortRows(f.sortMode)},f.scrollTo=function(a){f.ganttScroll[0].scrollLeft=a,f.ganttScroll.triggerHandler("scroll")},f.scrollLeft=function(a){f.ganttScroll[0].scrollLeft-=a,f.ganttScroll.triggerHandler("scroll")},f.scrollRight=function(a){f.ganttScroll[0].scrollLeft+=a,f.ganttScroll.triggerHandler("scroll")},f.scrollToDate=function(a){a=b.setTimeZero(a,!0),f.gantt.defaultDateRange.to=b.addDays(a,5,!0),f.gantt.expandDefaultDateRange(f.gantt.getFirstColumn().date,f.gantt.defaultDateRange.to);var c=f.gantt.getColumnByDate(a);void 0!==c&&i(function(){var a=(c.left+c.width/2)*f.getPxToEmFactor();f.ganttScroll[0].scrollLeft=a-f.ganttScroll[0].offsetWidth/2},10)},f.autoExpandColumns=e(f,function(a,c,d,e){if(f.autoExpand!==!0)return!1;var g,h;if(e=void 0===e?1:parseInt(e,10),"left"===d)g=c,h=c;else switch(g=c,f.viewScale){case"minutes":h=b.addHours(c,e,!0);break;case"twevelhours":case"eighthours":case"sixhours":case"threehours":case"hour":h=b.addDays(c,e,!0);break;case"day":h=b.addWeeks(c,e,!0);break;default:h=b.addMonths(c,e,!0)}f.gantt.expandDefaultDateRange(g,h)}),f.raiseLabelsResized=function(a){f.onLabelsResized({event:{width:a}})},f.raiseLabelClickedEvent=function(a,b){f.onLabelClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelDblClickedEvent=function(a,b){b.tasks.length>0&&(f.gantt.tasksOnMachine=b),f.onLabelDblClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelContextMenuEvent=function(a,b){f.onLabelContextClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelHeaderClickedEvent=function(a){f.onLabelHeaderClicked({event:{evt:a,userTriggered:!0}})},f.raiseLabelHeaderDblClickedEvent=function(a){f.onLabelHeaderDblClicked({event:{evt:a,userTriggered:!0}})},f.raiseLabelHeaderContextMenuEvent=function(a){f.onLabelHeaderContextClicked({event:{evt:a,userTriggered:!0}})},f.raiseRowAddedEvent=function(a,b){f.onRowAdded({event:{row:a,userTriggered:b}})},f.raiseDOMRowClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.gantt.contextMenu=void 0,f.raiseRowClickedEvent(b,g,h),a.stopPropagation(),a.preventDefault()},f.raiseRowClickedEvent=function(a,b,c){f.gantt.contextMenu=void 0,f.onRowClicked({event:{row:a,column:b.clone(),date:c,userTriggered:!0}})},f.raiseDOMRowDblClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowDblClickedEvent(a,b,g,h)},f.raiseRowDblClickedEvent=function(a,b,c,d){f.onRowDblClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},f.raiseDOMRowContextMenuEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowContextMenuEvent(a,b,g,h)},f.raiseRowContextMenuEvent=function(a,b,c,d){f.gantt.disable===!1&&(f.gantt.contextMenu={event:a,type:"row",target:b,element:void 0,items:[{key:"add",name:"Create Task"}]}),f.onRowContextClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}}),a.stopPropagation(),a.preventDefault()},f.raiseRowUpdatedEvent=function(a,b){f.onRowUpdated({event:{row:a,userTriggered:b}})},f.raiseScrollEvent=d(function(){if(f.ganttScroll[0].scrollLeft>=0){var a,b,c=f.ganttScroll[0];0===c.scrollLeft?(a="left",b=f.gantt.getDateRange().from):c.getBoundingClientRect().width+c.scrollLeft>=c.scrollWidth-20&&(a="right",b=f.gantt.getDateRange().to),void 0!==b&&(f.autoExpandColumns(c,b,a),f.onScroll({event:{date:b,direction:a,userTriggered:!0}}))}},5),f.raiseTaskUpdatedEvent=function(a,b){f.onTaskUpdated({event:{task:a,userTriggered:b}})},f.raiseTaskMoveStartEvent=function(a){f.onTaskMoveBegin({event:{task:a,userTriggered:!0}})},f.raiseTaskMoveEndEvent=function(a){f.onTaskMoveEnd({event:{task:a,userTriggered:!0}})},f.raiseTaskResizeStartEvent=function(a){f.onTaskResizeBegin({event:{task:a,userTriggered:!0}})},f.raiseTaskResizeEndEvent=function(a){f.onTaskResizeEnd({event:{task:a,userTriggered:!0}})},f.raiseTaskClickedEvent=function(a,b){f.onTaskClicked({event:{evt:a,task:b,userTriggered:!0}})},f.raiseTaskDblClickedEvent=function(a,b){f.onTaskDblClicked({event:{evt:a,task:b,userTriggered:!0}})},f.raiseTaskContextMenuEvent=function(a,b){f.onTaskContextClicked({event:{evt:a,task:b,userTriggered:!0}})},f.setData=e(f,function(a){if(void 0===a||"object"!=typeof a||0===a.length)throw"error";f.gantt.addData(a,function(a){f.raiseRowAddedEvent(a,!1)},function(a){f.raiseRowUpdatedEvent(a,!1)}),f.sortRows(),i(function(){f.$apply(function(){var a=f.gantt.getLastColumn().getPositionByDate(f.gantt.getLastColumn().date)*f.getPxToEmFactor();if(console.log(a,f.ganttScroll[0].scrollWidth,f.gantt.defaultDateRange),a<=f.ganttScroll[0].scrollWidth){var b=Math.ceil((f.ganttScroll[0].scrollWidth-a)/(f.gantt.getPositionByDate(f.gantt.getLastColumn().date)*f.getPxToEmFactor()));f.autoExpandColumns(f.ganttScroll[0],f.gantt.getLastColumn().date,"right",b),f.gantt.expandDefaultDateRange(f.gantt.getFirstColumn().date,f.gantt.getLastColumn().date)}f.gantt.departmentMap={};for(var c={},d=0,e=f.gantt.rowsMap,g=_.keys(e),h=g.length;h>d;++d){var i=e[g[d]].data.settingsMachine.dept;if(i.name in c){var j=c[i.name];void 0!==i.subDept&&""!==i.subDept&&(i.subDept in j.sub?c[i.name].sub[i.subDept].rows.push(e[g[d]]):c[i.name].sub[i.subDept]={sort:i.sort||0,rows:[e[g[d]]]}),c[i.name].rows.push(e[g[d]])}else c[i.name]={sub:{},rows:[],sort:i.sort||0},void 0!==i.subDept&&""!==i.subDept&&(c[i.name].sub[i.subDept]={sort:i.sort||0,rows:[e[g[d]]]}),c[i.name].rows=[e[g[d]]]}f.gantt.departmentMap=c})},10)}),f.removeData({fn:function(a){f.gantt.removeData(a,function(a){f.raiseRowUpdatedEvent(a,!1)}),f.sortRows()}}),f.removeAllData=function(){f.gantt.removeAllRows(),f.gantt.expandDefaultDateRange(f.fromDate,f.toDate)},f.exportGanttData=function(){for(var a="YYYY-MM-DDTHH:mm:ss",b=[],c=0,d=f.gantt.rows,e=d.length;e>c;c++){for(var h={machine:{id:d[c].id,settingsMachine:d[c].data.settingsMachine,factoryOperation:d[c].data.factoryOperation,title:d[c].data.title,currentTimeWorks:d[c].data.currentTimeWorks,online:d[c].data.online},operationQueue:[]},i=0,j=d[c].tasks,k=j.length;k>i;i++)h.operationQueue.push({id:j[i].id,oid:j[i].data.oid,part:j[i].data.part,operationCode:j[i].data.operationCode,priority:j[i].data.priority,job:j[i].data.job,process:j[i].data.process,previousOperation:j[i].data.previousOperation,nextOperations:j[i].data.nextOperations,runOnMachineId:d[c].id,actualRunOnMachineId:d[c].id,quantity:j[i].data.quantity,actualQuantity:j[i].data.actualQuantity,processingType:j[i].data.processingType,factoryOperation:j[i].data.factoryOperation,jobFile:j[i].data.jobFile,pin:j[i].isPin,setupTime:j[i].data.setupTime,productionTime:j[i].data.productionTime,productionCapacity:j[i].data.productionCapacity,s2sMins:j[i].data.s2sMins,up:j[i].data.up,sheetUp:j[i].data.sheetUp,expectedStartTime:j[i].from?moment(j[i].from).format(a):null,expectedSetupFinishTime:j[i].parallelFrom?moment(j[i].parallelFrom).format(a):null,expectedFinishTime:j[i].to?moment(j[i].to).format(a):null,actualStartTime:j[i].data.actualStartTime?moment(j[i].data.actualStartTime).format(a):null,actualSetupFinishTime:j[i].data.actualSetupFinishTime?moment(j[i].data.actualSetupFinishTime).format(a):null,actualFinishTime:j[i].data.actualFinishTime?moment(j[i].data.actualFinishTime).format(a):null,finished:j[i].isFinished,inProcessing:j[i].inProcessing,parallel:j[i].isParallel,parallelCode:j[i].data.parallelCode,expectedMoldId:j[i].data.expectedMoldId,tooltip1:j[i].data.tooltip1,tooltip2:j[i].data.tooltip2,tooltip3:j[i].data.tooltip3,color1:j[i].data.color1,color2:j[i].data.color2,timeclockEmployeeId:j[i].data.timeclockEmployeeId,"new":j[i].isNew,"delete":j[i].isDeleted,manual:j[i].isManual});b.push(h)}JSON.stringify(b),setTimeout(function(){g({method:"post",responseType:"json",url:f.gantt.ajaxUrl.serverLocation+f.gantt.ajaxUrl.confirmGanttUrl,data:b,params:{calculate:!0,calculateFrom:moment(f.gantt.getFirstColumn().date).format(a),calculateWeeks:52}}).then(function(a){if(a.data.messagesEmpty)f.loadData(a.data.data),f.gantt.disable=!0;else if(console.log("===============here are some errors============"),a.data.messages)for(;a.data.messages.length>0;)console.log(a.data.messages.pop().value);return!1},function(){return!1})},300)},f.ganttScroll.bind("scroll",f.raiseScrollEvent),f.loadData({fn:f.setData}),f.clearData({fn:f.removeAllData}),f.centerDate({fn:f.scrollToDate}),void f.onGanttReady())}]}}]),gantt.factory("Column",["dateFunctions",function(a){var b=function(a,b,c){return Math.round(b/a.width*c/(b/a.subScale))*(b/a.subScale)},c=function(a,b,c,d,e,f){var g;return g=b-a.date>0&&e!==f?1:Math.round(d/c*a.subScale)/a.subScale,Math.round(10*(a.left+a.width*g))/10},d=function(a,b,c,e){var f=this;f.date=a,f.left=b,f.width=c,f.subScale=e,f.clone=function(){return new d(f.date,f.left,f.width,f.subScale)},f.equals=function(a){return f.date===a.date}},e=function(e,f,g,h){var i=new d(e,f,g,h);return i.daysInMonth=a.getDaysInMonth(i.date),i.clone=function(){return new d(i.date,i.left,i.width,i.subScale)},i.getDateByPosition=function(c){0>c&&(c=0),c>i.width&&(c=i.width);var d=a.clone(i.date);return d.setDate(1+b(i,i.daysInMonth,c)),d},i.getPositionByDate=function(a){return c(i,a,i.daysInMonth,a.getDate(),a.getMonth(),i.date.getMonth())},i},f=function(e,f,g,h,i){var j=new d(e,f,g,h);j.week=a.getWeek(e),j.firstDayOfWeek=i,j.daysInWeek=7,j.clone=function(){var a=new d(j.date,j.left,j.width,j.subScale);return a.week=j.week,a};var k=function(a){return(j.daysInWeek-j.firstDayOfWeek+a)%j.daysInWeek},l=function(a){return(j.firstDayOfWeek+a)%j.daysInWeek},m=function(b){return 1===j.firstDayOfWeek?a.getWeek(b):void a.getWeek(a.addDays(b,1-j.firstDayOfWeek,!0))};return j.getDateByPosition=function(c){0>c&&(c=0),c>j.width&&(c=j.width);var d=a.clone(j.date),e=Math.round(b(j,j.daysInWeek,c)),f=7!==e&&0>e?-1:1;return a.setToDayOfWeek(d,7!==e?l(e):l(e)+7,!1,f),d},j.getPositionByDate=function(a){return c(j,a,j.daysInWeek,k(a.getDay()),m(a),m(j.date))},j},g=function(e,f,g,h,i,j,k,l,m){var n=new d(e,f,g,h);n.isWeekend=i,n.showNonWorkHours=m;var o=0,p=24;return 9==arguments.length&&!m&&l.length>1&&(o=l[0],p=l[l.length-1]+1),n.clone=function(){var a=new d(n.date,n.left,n.width,n.subScale);return a.isWeekend=n.isWeekend,a},n.getDateByPosition=function(c,d){0>c&&(c=0),c>n.width&&(c=n.width);var e=a.clone(n.date),f=o+b(n,p-o,c);return 2==arguments.length&&(f===p&&d?(e=a.addDays(e,j),f=o):f!==o||d||(e=a.addDays(e,-k),f=p)),e.setHours(f),e},n.getPositionByDate=function(b){if(a.setTimeZero(b,!0)>a.setTimeZero(n.date,!0))return n.left+n.width;var d=p-o,e=b.getHours()-o;return 0>e?n.left:e>d?n.left+n.width:c(n,b,d,e,b.getDate(),n.date.getDate())},n},h=function(e,f,g,h,i,j,k,l,m){var n=new d(e,f,g,h);return n.isWeekend=i,n.isWorkHour=j,n.clone=function(){var a=new d(n.date,n.left,n.width,n.subScale);return a.isWeekend=n.isWeekend,a.isWorkHour=n.isWorkHour,a},n.getDateByPosition=function(c,d){0>c&&(c=0),c>n.width&&(c=n.width);var e=a.clone(n.date),f=b(n,60*m,c);return 2==arguments.length&&(60===f&&d?(e=a.addHours(e,k),f=0):0!==f||d||(e=a.addHours(e,-l),f=60)),e.setMinutes(f),e},n.getPositionByDate=function(a){return c(n,a,60*m,a.getMinutes()+60*(a.getHours()-n.date.getHours()),a.getDay(),n.date.getDay())},n},i=function(e,f,g,h,i,j,k,l){var m=new d(e,f,g,h);return m.isWeekend=i,m.isWorkHour=j,m.clone=function(){var a=new d(m.date,m.left,m.width,m.subScale);return a.isWeekend=m.isWeekend,a.isWorkHour=m.isWorkHour,a},m.getDateByPosition=function(c,d){0>c&&(c=0),c>m.width&&(c=m.width);var e=a.clone(m.date),f=b(m,60,c);return 2==arguments.length&&(60===f&&d?(e=a.addHours(e,k),f=0):0!==f||d||(e=a.addHours(e,-l),f=60)),e.setMinutes(f),e},m.getPositionByDate=function(b){return a.setTimeZero(b,!0)>a.setTimeZero(m.date,!0)?m.left+m.width:c(m,b,60,b.getMinutes(),b.getHours(),m.date.getHours())},m},j=function(e,f,g,h,i,j){var k=new d(e,f,g,h);return k.isWeekend=i,k.isWorkHour=j,k.clone=function(){var a=new d(k.date,k.left,k.width,k.subScale);return a.isWeekend=k.isWeekend,a.isWorkHour=k.isWorkHour,a},k.getDateByPosition=function(c){0>c&&(c=0),c>k.width&&(c=k.width);var d=a.clone(k.date),e=b(k,60,c);return d.setSeconds(e),d},k.getPositionByDate=function(b){return a.setSecondsZero(b,!0)>a.setSecondsZero(k.date,!0)?k.left+k.width:c(k,b,60,b.getSeconds(),b.getMinutes(),k.date.getMinutes())},k};return{Minute:j,Hour:i,CustomHours:h,Day:g,Week:f,Month:e}}]),gantt.factory("ColumnGenerator",["Column","dateFunctions",function(a,b){var c=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},d=function(a,b){return a[b]===!0},e=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},f=function(a,b){return a[b]===!0},g=function(g,h,i,j,k,l){this.generate=function(o,p){var q=b.isSecondsZero(p);o=b.setSecondsZero(o,!0),p=b.setSecondsZero(p,!0);for(var r=b.clone(o),s=[],t=0,u=e(k),v=c(i);q&&p-r>0||!q&&p-r>=0;){for(var w=d(v,r.getDay()),x=0;60>x;x++){var y=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),x,0),z=f(u,y.getHours());if((w&&j||!w)&&(!z&&l||z)){var A=1,B=1;l||(A=m(u,y.getHours()),B=n(u,y.getHours())),s.push(new a.Minute(y,t,g,h,w,z,A,B)),t+=g}}r=b.addHours(r,1)}return s};var m=function(a,b){for(var c=1;25>c;c++){var d=(b+c)%24;if(f(a,d))return c}return 0},n=function(a,b){for(var c=1;25>c;c++){var d=((b-c)%24+24)%24;if(f(a,d))return c}return 0}},h=function(g,h,i,j,k,l){this.generate=function(o,p){var q=b.isMinutesZero(p);o=b.setMinutesZero(o,!0),p=b.setMinutesZero(p,!0);for(var r=b.clone(o),s=[],t=0,u=e(k),v=c(i);q&&p-r>0||!q&&p-r>=0;){for(var w=d(v,r.getDay()),x=0;24>x;x++){var y=new Date(r.getFullYear(),r.getMonth(),r.getDate(),x,0,0),z=f(u,x);if((w&&j||!w)&&(!z&&l||z)){var A=1,B=1;l||(A=m(u,y.getHours()),B=n(u,y.getHours())),s.push(new a.Hour(y,t,g,h,w,z,A,B)),t+=g}}r=b.addDays(r,1)}return s};var m=function(a,b){for(var c=1;25>c;c++){var d=(b+c)%24;if(f(a,d))return c}return 1},n=function(a,b){for(var c=1;25>c;c++){var d=((b-c)%24+24)%24;if(f(a,d))return c}return 1}},i=function(g,h,i,j,k,l,m){this.generate=function(p,q){var r=b.isMinutesZero(q);p=b.setMinutesZero(p,!0),q=b.setMinutesZero(q,!0);for(var s=b.clone(p),t=[],u=0,v=e(k),w=c(i);r&&q-s>0||!r&&q-s>=0;){for(var x=d(w,s.getDay()),y=0;24/m>y;y++){var z=new Date(s.getFullYear(),s.getMonth(),s.getDate(),y*m,0,0),A=f(v,y*m);if((x&&j||!x)&&(!A&&l||A)){var B=1,C=1;l||(B=n(v,z.getHours()),C=o(v,z.getHours())),t.push(new a.CustomHours(z,u,g,h,x,A,B,C,m)),u+=g}}s=b.addDays(s,1)}return t};var n=function(a,b){for(var c=1;25>c;c++){var d=(b+c)%24;if(f(a,d))return c}return 1},o=function(a,b){for(var c=1;25>c;c++){var d=((b-c)%24+24)%24;if(f(a,d))return c}return 1}},j=function(e,f,g,h,i,j){this.generate=function(m,n){var o=b.isTimeZero(n);m=b.setTimeZero(m,!0),n=b.setTimeZero(n,!0);for(var p=b.clone(m),q=[],r=0,s=c(g);o&&n-p>0||!o&&n-p>=0;){var t=d(s,p.getDay());if(t&&h||!t){var u=1,v=1;h||(u=k(s,p.getDay()),v=l(s,p.getDay())),q.push(new a.Day(b.clone(p),r,e,f,t,u,v,i,j)),r+=e}p=b.addDays(p,1)}return q};var k=function(a,b){for(var c=1;8>c;c++){var e=(b+c)%7;if(!d(a,e))return c}return 1},l=function(a,b){for(var c=1;8>c;c++){var e=((b-c)%7+7)%7;if(!d(a,e))return c}return 1}},k=function(c,d,e){this.generate=function(f,g){var h=g.getDay()===e&&b.isTimeZero(g);f=b.setToDayOfWeek(b.setTimeZero(f,!0),e,!1),g=b.setToDayOfWeek(b.setTimeZero(g,!0),e,!1);for(var i=b.clone(f),j=[],k=0;h&&g-i>0||!h&&g-i>=0;)j.push(new a.Week(b.clone(i),k,c,d,e)),k+=c,i=b.addWeeks(i,1);return j}},l=function(c,d){this.generate=function(e,f){var g=1===f.getDate()&&b.isTimeZero(f);e=b.setToFirstDayOfMonth(b.setTimeZero(e,!0),!1),f=b.setToFirstDayOfMonth(b.setTimeZero(f,!0),!1);for(var h=b.clone(e),i=[],j=0;g&&f-h>0||!g&&f-h>=0;)i.push(new a.Month(b.clone(h),j,c,d)),j+=c,h=b.addMonths(h,1);return i}};return{MinuteGenerator:g,HourGenerator:h,CustomHoursGenerator:i,DayGenerator:j,WeekGenerator:k,MonthGenerator:l}}]),gantt.factory("Gantt",["Row","Jobs","Processes","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch","_","IndexedDB",function(a,b,c,d,e,f,g,h,i){var j=function(j,k,l,m,n,o,p,q){{var r=this;new i("ganttMachineDB","machines"),new i("ganttJobDB","jobs"),new i("ganttTaskDB","tasks")}r.name="Gantt",r.rowsMap={},r.rows=[],r.rowsCounter=0,r.visibleRows=[],r.rowKey=0,r.jobsMap={},r.tasksMap={},r.processesMap={},r.departmentMap={},r.paginationMap={},r.columnPagination=[],r.columnPage=1,r.columnLimit=12,r.columns=[],r.headers={},r.width=0,r.defaultDateRange=void 0,r.contextMenu=void 0,r.jobFlowChart=void 0,r.tasksOnMachine=void 0,r.setViewScale=function(a,b,c,f,g,h,i,j){switch(a){case"minute":r.columnGenerator=new d.MinuteGenerator(b,c,g,h,i,j);break;case"hour":r.columnGenerator=new d.HourGenerator(b,c,g,h,i,j);break;case"threehours":r.columnGenerator=new d.CustomHoursGenerator(b,c,g,h,i,j,3);break;case"sixhours":r.columnGenerator=new d.CustomHoursGenerator(b,c,g,h,i,j,6);break;case"eighthours":r.columnGenerator=new d.CustomHoursGenerator(b,c,g,h,i,j,8);break;case"twevelhours":r.columnGenerator=new d.CustomHoursGenerator(b,c,g,h,i,j,12);break;case"day":r.columnGenerator=new d.DayGenerator(b,c,g,h,i,j);break;case"week":r.columnGenerator=new d.WeekGenerator(b,c,f);break;case"month":r.columnGenerator=new d.MonthGenerator(b,c);break;default:throw"Unsupported view scale: "+a}r.headerGenerator=new e.instance(a)},r.setViewScale(j,k,l,m,n,o,p,q),r.expandDefaultDateRange=function(a,b){void 0!==a&&void 0!==b&&(r.defaultDateRange={from:a,to:b},s(a,b),t())};var s=function(a,b){a=f.clone(a),b=f.clone(b),void 0===r.defaultDateRange?(r.defaultDateRange={},r.defaultDateRange.from=a,r.defaultDateRange.to=b):(a<r.defaultDateRange.from&&(r.defaultDateRange.from=a),b>r.defaultDateRange.to&&(r.defaultDateRange.to=b))},t=function(){if(void 0===r.defaultDateRange)throw"From and to date range cannot be undefined";if(0===r.columns.length)u(r.defaultDateRange.from,r.defaultDateRange.to);else if(r.getFirstColumn().date>r.defaultDateRange.from||r.getLastColumn().date<r.defaultDateRange.to){var a=r.getFirstColumn().date>r.defaultDateRange.from?r.defaultDateRange.from:r.getFirstColumn().date,b=r.getLastColumn().date<r.defaultDateRange.to?r.defaultDateRange.to:r.getLastColumn().date;u(a,b)}},u=function(a,b){r.columns=r.columnGenerator.generate(a,b),r.headers=r.headerGenerator.generate(r.columns),r.updateTasksPosAndSize();var c=r.getLastColumn();r.width=void 0!==c?c.left+c.width:0};r.reGenerateColumns=function(){return r.columns=[],void 0!==r.defaultDateRange?(t(),!0):!1},r.updateTasksPosAndSize=function(){for(var a=0,b=r.rows.length;b>a;a++)for(var c=0,d=r.rows[a].tasks.length;d>c;c++)r.rows[a].tasks[c].updatePosAndSize()},r.getLastColumn=function(){return r.columns.length>0?r.columns[r.columns.length-1]:void 0},r.getFirstColumn=function(){return r.columns.length>0?r.columns[0]:void 0},r.getColumnByDate=function(a){var b=g.get(r.columns,a,function(a){return a.date});return void 0!==b[0]?b[0]:b[1]},r.getColumnByPosition=function(a){return g.get(r.columns,a,function(a){return a.left})[0]},r.getDateByPosition=function(a,b){var c=r.getColumnByPosition(a);return void 0!==c?2==arguments.length?c.getDateByPosition(a-c.left,b):c.getDateByPosition(a-c.left):void 0},r.getPositionByDate=function(a){var b=r.getColumnByDate(a);return void 0!==b?b.getPositionByDate(a):void 0},r.getDateRange=function(){return void 0===r.defaultDateRange?void 0:{from:f.clone(r.defaultDateRange.from),to:f.clone(r.defaultDateRange.to)}},r.getTasksDateRange=function(){if(0===r.rows.length)return void 0;for(var a,b,c=0,d=r.rows.length;d>c;c++){var e=r.rows[c];(void 0===a||e.minFromDate<a)&&(a=e.minFromDate),(void 0===b||e.maxToDate>b)&&(b=e.maxToDate)}return{from:a,to:b}},r.getActiveHeadersCount=function(){var a,b=0;for(a in r.headers)r.headers.hasOwnProperty(a)&&b++;return b},r.addData=function(a,b,c){for(var d=0,e=a.length;e>d;d++){var f=a[d],g=v(f),i=r.rowsMap[f.id];g===!0&&void 0!==c?c(i):void 0!==b&&b(i)}void 0!==r.defaultDateRange&&t(),r.columnPagination=[];for(var j=0,k=0,l=h.keys(r.paginationMap),m=l.length;m>k;k++)void 0!==r.columnPagination[j]&&(r.columnPagination[j].length>=r.columnLimit||m>k+1&&r.columnPagination[j].length+r.paginationMap[l[k]].length>Math.ceil(1.5*r.columnLimit))&&j++,void 0===r.columnPagination[j]&&(r.columnPagination[j]=[]),r.columnPagination[j]=r.columnPagination[j].concat(r.paginationMap[l[k]]);r.rowsCounter=r.columnPagination[0].length};var v=function(d){var e,f,g=!1;if(void 0!==d.machine)e=d.machine,f="machine";else{if(void 0===d.mold)throw"error";e=d.mold,f="mold"}if(e.id in r.rowsMap)e=r.rowsMap[e.id],e.copy(d),g=!0;else{var i,j=e.order||e.id||void 0,k=e.description||void 0,l={};void 0===j&&(j=r.highestRowOrder||0),j>=r.highestRowOrder&&(r.highestRowOrder=j+1);for(i in e)void 0===l[i]&&(l[i]=e[i]);if(void 0===k)switch(f){case"machine":k=e.settingsMachine.name;break;case"job":k="JOB "+e.id;break;case"mold":k=""===e.settingsMold.descript||null===e.settingsMold.descript?e.settingsMold.name:e.settingsMold.descript;break;default:k=""}e=new a(e.id,r,f,k,j,l),r.rowsMap[e.id]=e,r.rows.push(e),r.rowKey++}var m=void 0!==d.operationQueue?d.operationQueue:void 0!==d.tasks?d.tasks:[];if(m.length>0){var n,o,p,q;for(n=0,q=m.length;q>n;n++){var u=e.addTask(m[n]);if(void 0!==u){s(u.from,u.to),u.updatePosAndSize();var v;m[n].process.id in r.processesMap?(v=r.processesMap[m[n].process.id],v.addTask(u),v.addPrevious(u.process.previousProcesses)):(v=new c(m[n].process,r),v.addTask(u),v.addPrevious(u.process.previousProcesses),r.processesMap[m[n].process.id]=v);var w;m[n].job.id in r.jobsMap?(w=r.jobsMap[m[n].job.id],w.addTask(r.rowKey,u)):(w=new b(m[n].job,r),w.addTask(r.rowKey,u),r.jobsMap[m[n].job.id]=w)}}for(n=0,q=h.keys(r.processesMap);n<q.length;++n)for(o=0,p=r.processesMap[q[n]].previous;o<p.length;++o)void 0!==r.processesMap[p[o]]&&r.processesMap[p[o]].addNext([r.processesMap[q[n]].id]);t()}return g};r.removeData=function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(void 0!==e.tasks&&e.tasks.length>0){if(e.id in r.rowsMap){for(var f=r.rowsMap[e.id],g=0,h=e.tasks.length;h>g;g++)f.removeTask(e.tasks[g].id);void 0!==b&&b(f)}}else w(e.id)}};var w=function(a){return void(a in r.rowsMap&&(r.rowsMap[a].showup=!1))};r.removeAllRows=function(){r.rowsMap={},r.rows=[],r.highestRowOrder=0,r.columns=[],r.defaultDateRange=void 0},r.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var x=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?y(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},y=function(a,b){return a.description.toLowerCase()===b.description.toLowerCase()?0:a.description.toLowerCase()<b.description.toLowerCase()?-1:1},z=function(a,b){return void 0===a.order&&void 0===b.order?y(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order},A=function(a,b){return void 0===a.department&&void 0===b.department&&void 0===a.department.id&&void 0===b.department.id?y(a,b):void 0===a.department.id?1:void 0===b.department.id?-1:a.department.id===b.department.id?0:a.department.id<b.department.id?-1:1};r.sortRows=function(a){switch(a){case"name":r.rows.sort(y);break;case"-name":r.rows.reverse(y);break;case"date":r.rows.reverse(x);break;case"-date":r.rows.reverse(x);break;case"dept":r.rows.sort(A);break;case"-dept":r.rows.sort(A);break;case"custom":r.rows.sort(z);break;case"-custom":r.rows.sort(z);break;default:r.rows.sort(x)}}};return j}]),gantt.factory("HeaderGenerator",["Column","dateFunctions",function(a,b){var c=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getMinutes()!==h.date.getMinutes()?(d=new a.Minute(b.clone(h.date),h.left,h.width,h.isWeekend,h.isWorkHour),e.push(d)):d.width+=h.width}return e},d=function(c,d){for(var e,f=[],g=0,h=c.length;h>g;g++){var i=c[g];0===g||c[g-1].date.getHours()!==i.date.getHours()?(e=new a.Hour(b.clone(i.date),i.left,i.width,i.isWeekend,i.isWorkHour),e.nexthour=b.addHours(b.clone(e.date),d),f.push(e)):e.width+=i.width}return f},e=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getDay()!==h.date.getDay()?(d=new a.Day(b.clone(h.date),h.left,h.width,h.isWeekend,h.daysToNextWorkingDay,h.daysToPrevWorkingDay),e.push(d)):d.width+=h.width}return e},f=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||b.getWeek(c[f-1].date)!==b.getWeek(h.date)?(d=new a.Week(b.clone(h.date),h.left,h.width,b.getWeek(h.date)),e.push(d)):d.width+=h.width}return e},g=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getMonth()!==h.date.getMonth()?(d=new a.Month(b.clone(h.date),h.left,h.width),e.push(d)):d.width+=h.width}return e};return{instance:function(a){this.generate=function(b){var h={};switch(a){case"minute":h.minute=c(b),h.hour=d(b);break;case"threehours":h.hour=d(b,3),h.day=e(b);break;case"sixhours":h.hour=d(b,6),h.day=e(b);break;case"eighthours":h.hour=d(b,8),h.day=e(b);break;case"twevelhours":h.hour=d(b,12),h.day=e(b);break;case"hour":h.hour=d(b),h.day=e(b);break;case"day":h.day=e(b),h.month=g(b);break;case"week":h.week=f(b),h.month=g(b);break;case"month":h.month=g(b);break;default:throw"Unsupported view scale: "+a}return h}}}}]),gantt.factory("Jobs",["dateFunctions","binarySearch","_",function(){var a=function(a,b){var c=this;c.id=a.id,c.name="Job",c.gantt=b,c.comboType=a.comboType,c.comboId=a.comboId,c.poNo=a.poNo,c.comboQuantity=a.comboQuantity,c.processes=[],c.tasks=[],c.addTask=function(a,b){return void 0===b.rowKey&&(b.rowKey=a),c.tasks.push(b),c.processes.indexOf(b.process.id)<0&&c.processes.push(b.process.id),c.tasks.sort(function(a,b){return a.left-b.left}),c.tasks}};return a}]),gantt.factory("Processes",["dateFunctions","binarySearch","_",function(a,b,c){var d=function(a,b){var d=this;d.id=a.id,d.name="Process",d.gantt=b,d.productId=a.productId,d.waitPrevious=a.needWaitPrevProcess===!0?!0:!1,d.operations=a.operations,d.previous=[],d.tasks=[],d.next=[],d.addTask=function(a){d.tasks.push(a),d.tasks.sort(function(a,b){return a.from-b.from})},d.addPrevious=function(a){d.previous=c.union(d.previous,a)},d.addNext=function(a){d.next=c.union(d.next,a)}};return d}]),gantt.factory("Row",["Task","dateFunctions","_",function(a,b){var c=function(d,e,f,g,h,i){var j=this;j.id=d,j.name="Row",j.type=f,j.gantt=e,j.description=g,j.order=h,j.tasksMap={},j.tasks=[],j.data=i,j.showup=!0,"machine"===f&&(j.department=i.settingsMachine.dept,j.department.code in e.paginationMap?e.paginationMap[j.department.code].indexOf(j.id)<0&&e.paginationMap[j.department.code].push(j.id):e.paginationMap[j.department.code]=[j.id]),j.RGBtoHex=function(a){if(void 0===a||""===a)return"#efefef";var b=11*a%123,c=17*a%123,d=23*a%123;return b=100>b?(b+100).toString(16):b.toString(16),c=100>c?(c+100).toString(16):c.toString(16),d=100>d?(d+100).toString(16):d.toString(16),"#"+(1===b.length?"0"+b:b)+(1===c.length?"0"+c:c)+(1===d.length?"0"+d:d)},j.addTask=function(b){var c,d,f;if(b.id in j.tasksMap)c=j.tasksMap[b.id],c.copy(b);else{var g,h=b.color1.replace("0x","#"),i={};for(g in b)void 0===i[g]&&(i[g]=b[g]);d=null===b.actualStartTime||void 0===b.actualStartTime?b.expectedStartTime:b.actualStartTime,f=null===b.actualFinishTime||void 0===b.actualFinishTime?b.expectedFinishTime:b.actualFinishTime,c=new a(b.id,j,b.operationCode,h,[],b.priority,d,f,i,void 0,void 0),j.tasksMap[b.id]=c,j.tasks.push(c),e.tasksMap[b.id]=c}return void 0!==c&&(j.sortTasks(),j.setMinMaxDateByTask(c)),c},j.moveTaskToRow=function(a){a.rowHasBeenChanged=!0,a.preventRowId=a.row.id,a.row.removeTask(a.id),j.tasksMap[a.id]=a,j.tasks.push(a),j.setTasksMinMaxDate(),a.row=j,a.updatePosAndSize()},j.removeTask=function(a){if(a in j.tasksMap){delete j.tasksMap[a];for(var b=0,c=j.tasks.length;c>b;b++){var d=j.tasks[b];if(d.id===a)return j.tasks.splice(b,1),(j.minFromDate-d.from===0||j.maxToDate-d.to===0)&&j.setTasksMinMaxDate(),d}}},j.setTasksMinMaxDate=function(){j.minFromDate=void 0,j.maxToDate=void 0;for(var a=0,b=j.tasks.length;b>a;a++)j.setMinMaxDateByTask(j.tasks[a])},j.setMinMaxDateByTask=function(a){void 0===j.minFromDate?j.minFromDate=b.clone(a.from):a.from<j.minFromDate&&(j.minFromDate=b.clone(a.from)),void 0===j.maxToDate?j.maxToDate=b.clone(a.to):a.to>j.maxToDate&&(j.maxToDate=b.clone(a.to))
},j.sortTasks=function(){j.tasks.sort(function(a,b){return a.left-b.left})},j.copy=function(a){j.description=a.description||void 0,void 0!==a.order&&(j.order=a.order)},j.clone=function(){for(var a=new c(j.id,j.gantt,j.description,j.order),b=0,d=j.tasks.length;d>b;b++)a.addTask(j.tasks[b].clone());return a}};return c}]),gantt.factory("IndexedDB",["$window","$q","binarySearch",function(a,b){var c=function(c,d,e){var f=this,g=a.IDBKeyRange||a.webkitIDBKeyRange||a.msIDBKeyRange;f.name="Store",f.indexedDB=a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,f.db=c||"GanttStoreDB",f.storeName=d||"machines",f.version=e||1,f.lastIndex=0,f.open=function(a,c){var d=b.defer(),e=f.indexedDB.open(f.db,c||f.version);return f.storeName=a||f.storeName,e.onupgradeneeded=function(a){f.db=a.target.result,a.target.transaction.onerror=f.indexedDB.onerror,f.db.objectStoreNames.contains(f.storeName)&&f.db.deleteObjectStore(f.storeName);f.db.createObjectStore(f.storeName,{keyPath:"id"})},e.onsuccess=function(a){f.db=a.target.result,d.resolve()},e.onerror=function(){d.reject()},d.promise},f.clear=function(){var a=b.defer();if(null===f.db)a.reject("IndexDB is not opened yet!");else{var c=f.db.transaction([f.storeName],"readwrite"),d=c.objectStore(f.storeName),e=d.clear();e.onsuccess=function(){a.resolve([])},e.onerror=function(){a.reject("Cannot clear the store object!")}}return a.promise},f.getItems=function(){var a=b.defer();if(null===f.db)a.reject("IndexDB is not opened yet!");else{var c=f.db.transaction([f.storeName],"readwrite"),d=c.objectStore(f.storeName),e=[],h=g.lowerBound(0),i=d.openCursor(h);i.onsuccess=function(b){var c=b.target.result;null===c||void 0===c?a.resolve(e):(e.push(c.value),c.value.id>f.lastIndex&&(f.lastIndex=c.value.id),c.continue())},i.onerror=function(){a.reject("Something went wrong!!!")}}return a.promise},f.removeItem=function(a){var c=b.defer();if(null===f.db)c.reject("IndexDB is not opened yet!");else{var d=db.transaction([f.storeName],"readwrite"),e=d.objectStore(f.storeName),g=e.delete(a);g.onsuccess=function(){c.resolve()},g.onerror=function(){c.reject("Machine item couldn't be removed.")}}return c.promise},f.addTask=function(a){var c=b.defer();if(null===f.db)c.reject("IndexDB is not opened yet!");else{var d=f.db.transaction([f.storeName],"readwrite"),e=d.objectStore(f.storeName);f.lastIndex++;var g=e.put({id:a.id,operationCode:a.operationCode,priority:a.priority,job:a.job,process:a.process,previousOperation:a.previousOperation,nextOperations:a.nextOperations,runOnMachineId:a.runOnMachineId,actualRunOnMachineId:a.actualRunOnMachineId,quantity:a.quantity,processingType:a.processingType,factoryOperation:a.factoryOperation,jobFile:a.jobFile,pin:a.pin,setupTime:a.setupTime,productionTime:a.productionTime,productionCapacity:a.productionCapacity,s2sMins:a.s2sMins,expectedStartTime:a.expectedStartTime,expectedSetupFinishTime:a.expectedSetupFinishTime,expectedFinishTime:a.expectedFinishTime,actualStartTime:a.actualStartTime,actualSetupFinishTime:a.actualSetupFinishTime,actualFinishTime:a.actualFinishTime,finished:a.finished,inProcessing:a.inProcessing,parallel:a.parallel,parallelCode:a.parallelCode,expectedMoldId:a.expectedMoldId,tooltip1:a.tooltip1,tooltip2:a.tooltip2,tooltip3:a.tooltip3,color1:a.color1,color2:a.color2,"new":a.new});g.onsuccess=function(){c.resolve()},g.onerror=function(){c.reject("Machine item couldn't be added!")}}return c.promise},f.addJob=function(a){var c=b.defer();if(null===f.db)c.reject("IndexDB is not opened yet!");else{var d=f.db.transaction([f.storeName],"readwrite"),e=d.objectStore(f.storeName);f.lastIndex++;var g=e.put({id:a.id,operationQueue:a.operationQueue});g.onsuccess=function(){c.resolve()},g.onerror=function(){c.reject("Machine item couldn't be added!")}}return c.promise},f.addMachine=function(a){var c=b.defer();if(null===f.db)c.reject("IndexDB is not opened yet!");else{var d=f.db.transaction([f.storeName],"readwrite"),e=d.objectStore(f.storeName);f.lastIndex++;var g=e.put({id:a.id,code:a.settingsMachine.code,settingsMachine:a.settingsMachine,factoryOperation:a.factoryOperation,currentTimeWorks:a.currentTimeWorks,online:a.online,operationQueue:a.operationQueue});g.onsuccess=function(){c.resolve()},g.onerror=function(){c.reject("Machine item couldn't be added!")}}return c.promise}};return c}]),gantt.factory("Task",["dateFunctions","_",function(a,b){var c=function(d,e,f,g,h,i,j,k,l,m,n){var o=this;o.id=d,o.name="Task",o.gantt=e.gantt,o.row=e,o.subject=f+"("+d+")",o.color=g,o.classes=h,o.priority=i,o.from=a.clone(j),o.to=a.clone(k),o.process=l.process,o.job=l.job,o.previousOperation=l.previousOperation,o.nextOperations=l.nextOperations,o.data=l,o.tooltips={},o.dirty=!1,o.rowHasBeenChanged=!1,o.preventRowId=e.id,o.openLightbox=!1,o.openContextMenu=!1,o.est=a.clone(j),o.lct=a.clone(k),o.showup=!0,void 0!==m&&void 0!==n&&(o.est=a.clone(m),o.lct=a.clone(n)),o.checkIfMilestone=function(){o.isMilestone=o.from-o.to===0},o.checkIfFinished=function(){o.isFinished=!!o.data.finished},o.checkIfInProcessing=function(){o.inProcessing=!!o.data.inProcessing},o.checkIfPin=function(){o.isPin=!!o.data.pin},o.checkIfDelete=function(){o.isDeleted=!!o.data.delete},o.checkIfManual=function(){o.isManual=!!o.data.manual},o.checkParallelFrom=function(){var b=null===o.data.actualSetupFinishTime||void 0===o.data.actualSetupFinishTime?o.data.expectedSetupFinishTime:o.data.actualSetupFinishTime;o.isParallel===!0&&o.data.s2sMins>=0?(o.parallelFrom=a.clone(b),o.parallelFrom=a.addMinutes(o.parallelFrom,o.data.s2sMins,!0)):(o.parallelFrom=a.clone(o.to),o.isParallel=!1)},o.checkIfParallel=function(){o.isParallel=!!o.data.parallel,o.checkParallelFrom()},o.rejectMoving=function(){var b=null===o.data.actualStartTime||void 0===o.data.actualStartTime?o.data.expectedStartTime:o.data.actualStartTime,c=null===o.data.actualFinishTime||void 0===o.data.actualFinishTime?o.data.expectedFinishTime:o.data.actualFinishTime,d=null===o.data.actualSetupFinishTime||void 0===o.data.actualSetupFinishTime?o.data.expectedSetupFinishTime:o.data.actualSetupFinishTime;o.dirty=!1,o.from=a.clone(b),o.to=a.clone(c),o.isParallel===!0?(o.parallelFrom=a.clone(d),o.parallelFrom=a.addMinutes(o.parallelFrom,o.data.s2sMins,!0)):o.parallelFrom=o.to,o.row.setMinMaxDateByTask(o),o.updatePosAndSize(),o.checkIfMilestone()},o.updateMoving=function(){o.dirty=!1;var b=null===o.data.actualStartTime||void 0===o.data.actualStartTime?o.data.expectedStartTime:o.data.actualStartTime,c=(null===o.data.actualFinishTime||void 0===o.data.actualFinishTime?o.data.expectedFinishTime:o.data.actualFinishTime,null===o.data.actualSetupFinishTime||void 0===o.data.actualSetupFinishTime?o.data.expectedSetupFinishTime:o.data.actualSetupFinishTime),d=a.clone(c)-a.clone(b);d=a.addMilliseconds(o.from,d,!0),o.expectedFinishTime=o.to.toISOString(),o.expectedStartTime=o.from.toISOString(),o.expectedSetupFinishTime=d.toISOString(),o.parallelFrom=o.isParallel===!0?a.addMinutes(d,o.data.s2sMins,!0):o.to},o.prepareTooltips=function(){for(var a={tip:o.data.tooltip1,ui:o.data.tooltip2,chart:o.data.tooltip3},c=0,d=b.keys(a),e=d.length;e>c;++c)o.tooltips[d[c]]=a[d[c]].split("|")},o.checkIfDelete(),o.checkIfManual(),o.checkIfMilestone(),o.checkIfInProcessing(),o.checkIfFinished(),o.checkIfPin(),o.checkIfParallel(),o.prepareTooltips(),o.hasBounds=function(){return void 0!==o.bounds},o.updatePosAndSize=function(){o.left=o.gantt.getPositionByDate(o.from),o.width=Math.round(10*(o.gantt.getPositionByDate(o.to)-o.left))/10,o.row.tasks.sort(function(a,b){return a.from-b.from});for(var b=0,c=o.row.tasks,d=c.length;d>b;b++)if(c[b].id===o.id){o.est=void 0!==c[b-1]?a.addMinutes(c[b-1].to,1,!0):a.clone(o.from),o.lct=void 0!==c[b+1]?a.addMinutes(c[b+1].from,-1,!0):a.clone(o.to);break}void 0!==o.est&&void 0!==o.lct&&(o.bounds={},o.bounds.left=o.gantt.getPositionByDate(o.est),o.bounds.width=Math.round(10*(o.gantt.getPositionByDate(o.lct)-o.bounds.left))/10)},o.setFrom=function(b){b>o.left+o.width?b=o.left+o.width:0>b&&(b=0),o.from=o.gantt.getDateByPosition(b,!0),o.est=a.clone(o.from),o.row.setMinMaxDateByTask(o),o.updatePosAndSize(),o.checkIfMilestone()},o.setTo=function(b){b<o.left?b=o.left:b>o.gantt.width&&(b=o.gantt.width),o.to=o.gantt.getDateByPosition(b,!1),o.lct=a.clone(o.to),o.row.setMinMaxDateByTask(o),o.updatePosAndSize(),o.checkIfMilestone()},o.moveTo=function(a){0>a?a=0:a+o.width>=o.gantt.width&&(a=o.gantt.width-o.width),o.from=o.gantt.getDateByPosition(a,!0),o.left=o.gantt.getPositionByDate(o.from),o.to=o.gantt.getDateByPosition(o.left+o.width,!1),o.width=Math.round(10*(o.gantt.getPositionByDate(o.to)-o.left))/10,o.row.setMinMaxDateByTask(o)},o.copy=function(b){o.subject=b.subject,o.color=b.color,o.classes=b.classes,o.priority=b.priority,o.from=a.clone(b.from),o.to=a.clone(b.to),o.est=void 0!==b.est?a.clone(b.est):void 0,o.lct=void 0!==b.lct?a.clone(b.lct):void 0,l=b.data,o.isMilestone=b.isMilestone},o.clone=function(){return new c(o.id,o.row,o.subject,o.color,o.classes,o.priority,o.from,o.to,l,o.est,o.lct)}};return c}]),gantt.service("binarySearch",[function(){return{getIndicesOnly:function(a,b,c){for(var d=-1,e=a.length;e-d>1;){var f=(d+e)/2|0;c(a[f])<=b?d=f:e=f}return void 0!==a[d]&&c(a[d])===b&&(e=d),[d,e]},get:function(a,b,c){var d=this.getIndicesOnly(a,b,c);return[a[d[0]],a[d[1]]]},containsKeyValue:function(a,b,c){if(a[b]===c)return!0;var d,e=!1;for(d in a)return null!==a[d]&&a[d][b]===c?!0:"object"==typeof a[d]&&null!==a[d]&&(e=containsKeyValue(a[d],b,c),e===!0)?!0:!1},quickSort:function(a){if(a.length<=1)return a;for(var b=a.length/2|0,c=a.splice(b,1),d=[],e=[],f=0;f<a.length;f++)a[f].from<c[0].from?d.push(a[f]):e.push(a[f]);return this.quickSort(d).concat(c,this.quickSort(e))},inArray:function(a,b,c){var d="",e=!!c;if(e){for(d in b)if(b[d]===a)return!0}else for(d in b)if(b[d]==a)return!0;return!1}}}]),gantt.service("coloured",[function(){return{isDarkColoured:function(a){var b=parseInt(a.substr(1,2),16),c=parseInt(a.substr(3,2),16),d=parseInt(a.substr(5,2),16),e=.299*b+.587*c+.114*d;return 192>=e}}}]),gantt.service("dateFunctions",[function(){return{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return this.isString(a)?moment(a,"YYYY-MM-DDTHH:mm:ss").toDate():new Date(this.isNumber(a)?a:a.getTime())},setSecondsZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setSeconds(0),c.setMilliseconds(0),c},setMinutesZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0),c},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setMilliseconds(0),c},setTimeComponent:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,b)},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c,d){var e=c===!0?this.clone(a):a;if(e.getDay()===b)return e;d=d||-1;var f=(b-e.getDay()+7*(d||1))%7;return this.addDays(e,0===f?f+=7*(d||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(d.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(d.getMinutes()+b),d},addSeconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setSeconds(d.getSeconds()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(d.getMilliseconds()+b),d},isSecondsZero:function(a){return 0===a.getSeconds()&&0===a.getMilliseconds()},isMinutesZero:function(a){return 0===a.getMinutes()&&0===a.getSeconds()&&0===a.getMilliseconds()},isTimeZero:function(a){return 0===a.getHours()&&0===a.getMinutes()&&0===a.getSeconds()&&0===a.getMilliseconds()},getDaysInMonth:function(a){return new Date(a.getYear(),a.getMonth()+1,0).getDate()},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=j+3-h|0,n=0>l?53-((k-m)/5|0):l>364+m?1:(l/7|0)+1,b=c=d=null,n}}}]),gantt.service("taskWorker",["dateFunctions",function(a){return{workerSource:function(){return"assets/taskmoveworker.js"},prepareWorker:function(b,c){var d,e,f,g={},h={},i=a.clone(b.data.expectedFinishTime);for(i=a.clone("left"===this.detectTaskDirection(b)?b.from:b.data.expectedStartTime),d=0,e=_.keys(c.processesMap),f=e.length;f>d;++d)g[e[d]]={previous:c.processesMap[e[d]].previous};for(d=0,e=_.keys(c.tasksMap),f=e.length;f>d;++d)h[e[d]]={id:c.tasksMap[e[d]].id,from:a.clone(c.tasksMap[e[d]].from),to:a.clone(c.tasksMap[e[d]].to),data:c.tasksMap[e[d]].data,isPin:c.tasksMap[e[d]].isPin,isFinished:c.tasksMap[e[d]].isFinished,inProcessing:c.tasksMap[e[d]].inProcessing,isParallel:c.tasksMap[e[d]].isParallel,parallelFrom:c.tasksMap[e[d]].parallelFrom,nextOperations:c.tasksMap[e[d]].nextOperations,process:c.tasksMap[e[d]].process,row:{id:c.tasksMap[e[d]].row.id}};return{task:{id:b.id,from:a.clone(b.from),to:a.clone(b.to),data:b.data,isPin:b.isPin,isFinished:b.isFinished,inProcessing:b.inProcessing,isParallel:b.isParallel,parallelFrom:b.parallelFrom,nextOperations:b.nextOperations,process:{id:b.process.id},row:{id:b.row.id}},processesMap:g,tasksMap:h,timestamp:i}},detectTaskDirection:function(b){var c={left:b.from-a.clone(b.data.expectedStartTime),right:b.to-a.clone(b.data.expectedFinishTime)};return c.left<0&&c.right<0||c.left<0&&0===c.right||0===c.left&&c.right<0?"left":c.left>0&&c.right>0||c.left>0&&0===c.right||0===c.left&&c.right>0?"right":void 0},run:function(b,c,d){var e=this.prepareWorker(b,c),f=!1,g=new Worker(c.ajaxUrl.serverLocation+c.ajaxUrl.jsLocationPrefix+this.workerSource());g.onmessage=function(e){f=e.data.rejectTaskMoving;var g,h="YYYY-MM-DDTHH:mm:ss";if(f===!0){for(i=0,j=e.data.tasksOnMark,l=j.length;l>i;++i)c.tasksMap[j[i].id].rowHasBeenChanged===!0&&c.tasksMap[j[i].id].preventRowId!==c.tasksMap[j[i].id].row.id&&(c.tasksMap[j[i].id].row.removeTask(j[i].id),c.rowsMap[j[i].preventRowId].tasksMap[j[i].id]=c.tasksMap[j[i].id],c.rowsMap[j[i].preventRowId].tasks.push(c.tasksMap[j[i].id]),c.rowsMap[j[i].preventRowId].setTasksMinMaxDate(),c.tasksMap[j[i].id].row=c.rowsMap[j[i].preventRowId],c.tasksMap[j[i].id].rowHasBeenChanged=!1),c.tasksMap[j[i].id].from=a.clone(c.tasksMap[j[i].id].data.expectedStartTime),c.tasksMap[j[i].id].to=a.clone(c.tasksMap[j[i].id].data.expectedFinishTime),c.tasksMap[j[i].id].parallelFrom=a.clone(c.tasksMap[j[i].id].data.expectedSetupFinishTime),c.tasksMap[j[i].id].parallelFrom=a.addMinutes(c.tasksMap[j[i].id].parallelFrom,c.tasksMap[j[i].id].data.s2sMins,!0),c.tasksMap[j[i].id].row.setMinMaxDateByTask(c.tasksMap[j[i].id]),c.tasksMap[j[i].id].updatePosAndSize(),c.tasksMap[j[i].id].checkIfMilestone();b.rowHasBeenChanged===!0&&b.preventRowId!==b.row.id&&(b.row.removeTask(b.id),c.rowsMap[b.preventRowId].tasksMap[b.id]=b,c.rowsMap[b.preventRowId].tasks.push(b),c.rowsMap[b.preventRowId].setTasksMinMaxDate(),b.row=c.rowsMap[b.preventRowId],b.rowHasBeenChanged=!1),b.from=a.clone(b.data.expectedStartTime),b.to=a.clone(b.data.expectedFinishTime),b.parallelFrom=a.clone(b.data.expectedSetupFinishTime),b.parallelFrom=a.addMinutes(b.parallelFrom,b.data.s2sMins,!0)}else{for(i=0,j=e.data.tasksOnMark,l=j.length;l>i;++i)c.tasksMap[j[i].id].from=j[i].from,c.tasksMap[j[i].id].to=j[i].to,c.tasksMap[j[i].id].parallelFrom=j[i].parallelFrom,g=a.clone(c.tasksMap[j[i].id].data.expectedSetupFinishTime)-a.clone(c.tasksMap[j[i].id].data.expectedStartTime),g=a.addMilliseconds(j[i].from,g,!0),c.tasksMap[j[i].id].data.expectedStartTime=moment(j[i].from).format(h),c.tasksMap[j[i].id].data.expectedFinishTime=moment(j[i].to).format(h),c.tasksMap[j[i].id].data.expectedSetupFinishTime=moment(g).format(h),c.tasksMap[j[i].id].parallelFrom=c.tasksMap[j[i].id].isParallel===!0?a.addMinutes(g,c.tasksMap[j[i].id].data.s2sMins,!0):c.tasksMap[j[i].id].to,c.tasksMap[j[i].id].row.setMinMaxDateByTask(c.tasksMap[j[i].id]),c.tasksMap[j[i].id].updatePosAndSize(),c.tasksMap[j[i].id].checkIfMilestone();g=a.clone(b.data.expectedSetupFinishTime)-a.clone(b.data.expectedStartTime),g=a.addMilliseconds(b.from,g,!0),b.data.expectedStartTime=moment(b.from).format(h),b.data.expectedFinishTime=moment(b.to).format(h),b.data.expectedSetupFinishTime=moment(g).format(h),b.parallelFrom=b.isParallel===!0?a.addMinutes(g,b.data.s2sMins,!0):b.to}b.row.setMinMaxDateByTask(b),b.updatePosAndSize(),b.checkIfMilestone(),"function"==typeof d&&setTimeout(function(){d.call(this,f,"ok",e.data)},500)},g.onerror=function(a){throw"function"==typeof d&&d.call(this,f,"error",a.data),a.data},g.postMessage(e)}}}]),angular.module("underscore",[]).factory("_",function(){return window._}),gantt.filter("ganttColumnLimit",["binarySearch",function(a){return function(b,c,d){var e=function(a){return a.left},f=a.getIndicesOnly(b,c,e)[0],g=a.getIndicesOnly(b,c+d,e)[1];return b.slice(f,g)}}]),gantt.filter("ganttMachineUI2Limit",["_",function(){return function(a){return a}}]),gantt.filter("ganttColumnPaginationLimit",["_",function(a){return function(b,c,d){if(d>0&&void 0!==c&&void 0!==c[d-1]){var e=[];return a.each(b,function(a){c[d-1].indexOf(a.id)>=0&&e.push(a)}),e}return b}}]),gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){var d=c[0],e=function(){b.scroll_start=d.scrollLeft/b.getPxToEmFactor(),b.scroll_width=d.offsetWidth/b.getPxToEmFactor()};c.bind("scroll",function(){b.$apply(function(){e()})}),b.$watch("gantt.width",function(){a(function(){e()},20,!0)})}]}}]),gantt.filter("ganttTaskLimit",[function(){return function(a,b,c){for(var d=[],e=0,f=a.length;f>e;e++){var g=a[e];(g.left>=b&&g.left<=b+c||g.left+g.width>=b&&g.left+g.width<=b+c||g.left<b&&g.left+g.width>b+c||g.isMoving===!0)&&d.push(g)}return d}}]),gantt.directive("ganttLabelResizable",["$document","debounce","mouseOffset",function(a,b,c){return{restrict:"A",scope:{width:"=ganttLabelResizable",minWidth:"=ganttLabelResizeMin",onResized:"&onLabelResized"},controller:["$scope","$element",function(d,e){var f,g=5,h="ew-resize";e.bind("mousedown",function(a){j(a)&&(k(a),a.preventDefault())}),e.bind("mousemove",function(a){j(a)?e.css("cursor",h):e.css("cursor","")});var i=function(a){0===d.width&&(d.width=e[0].offsetWidth),d.width+=a-f,d.width<d.minWidth&&(d.width=d.minWidth),f=a},j=function(a){var b=c.getOffset(a).x;return b>e[0].offsetWidth-g},k=function(c){f=c.screenX,angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:h});var d=b(function(a){i(a.screenX)},5);angular.element(a[0].body).bind("mousemove",d),angular.element(a[0].body).one("mouseup",function(){angular.element(a[0].body).unbind("mousemove",d),l()})},l=function(){e.css("cursor",""),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),d.onResized({width:d.width})}}]}}]),gantt.directive("ganttRightClick",["$parse",function(a){return{restrict:"A",compile:function(b,c){var d=a(c.ganttRightClick);return function(a,b){b.on("contextmenu",function(b){a.$apply(function(){d(a,{$event:b})})})}}}}]),gantt.directive("ganttHorizontalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.horizontal.push(c[0])}]}}]),gantt.service("scrollManager",[function(){return{vertical:[],horizontal:[]}}]),gantt.directive("ganttScrollSender",["scrollManager","$timeout",function(a,b){return{restrict:"A",controller:["$scope","$element",function(c,d){var e=d[0],f=function(){var b,c;for(b=0,c=a.vertical.length;c>b;b++){var d=a.vertical[b];d.style.top!==-e.scrollTop&&(d.style.top=-e.scrollTop+"px")}for(b=0,c=a.horizontal.length;c>b;b++){var f=a.horizontal[b];f.style.left!==-e.scrollLeft&&(f.style.left=-e.scrollLeft+"px")}};d.bind("scroll",f),c.$watch("gantt.width",function(a){0===a&&b(function(){f()},20,!0)})}]}}]),gantt.directive("ganttVerticalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.vertical.push(c[0])}]}}]),gantt.service("sortManager",[function(){return{startRow:void 0}}]),gantt.directive("ganttSortable",["$document","sortManager",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){if(c.active===!0){f();var b=function(){c.$apply(function(){angular.element(a[0].body).unbind("mouseup",b),g()})};angular.element(a[0].body).bind("mouseup",b)}}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.directive("ganttBounds",[function(){var a="";return{restrict:"E",link:function(b){a=b.$parent.gantt.ajaxUrl.serverLocation+b.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(b,c){return void 0===c.templateUrl?a+"default.bounds.tmpl.html":a+c.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){var b={};a.task.hasBounds()||(a.visible=!1),a.getCss=function(){return a.task.hasBounds()&&(b.width=a.task.bounds.width+"em",b.left=a.task.isMilestone===!0||0===a.task.width?a.task.bounds.left-(a.task.left-.3)+"em":a.task.bounds.left-a.task.left+"em"),b},a.getClass=function(){return void 0===a.task.est||void 0===a.task.lct?"gantt-task-bounds-in":a.task.est>a.task.from?"gantt-task-bounds-out":a.task.lct<a.task.to?"gantt-task-bounds-out":"gantt-task-bounds-in"},a.$watch("task.isMouseOver",function(){a.task.hasBounds()&&!a.task.isMoving&&(a.visible=!(void 0===a.task.isMouseOver||a.task.isMouseOver===!1))}),a.$watch("task.isMoving",function(b){a.task.hasBounds()&&(a.visible=b===!0)})}]}}]),gantt.directive("ganttTask",["$window","$document","$timeout","smartEvent","debounce","dateFunctions","mouseOffset","mouseButton","binarySearch","_","taskWorker","coloured",function(a,b,c,d,e,f,g,h,i,j,k,l){var m="";return{restrict:"E",link:function(a){m=a.gantt.ajaxUrl.serverLocation+a.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?m+"default.task.tmpl.html":m+b.templateUrl},replace:!0,controller:["$scope","$element",function(i,m){var n,o,p,q=5,r=3,s=15,t=5,u=angular.element(a),v=m.parent().parent(),w=v.parent().parent(),x=!1;i.css=function(a){return{color:l.isDarkColoured(a.replace("#",""))?"#ffffff":"#000000"}},m.bind("mousedown",function(a){i.gantt.contextMenu=void 0,i.task.isFinished===!0||i.task.inProcessing===!0||i.gantt.disable===!0?(a.stopPropagation(),a.preventDefault()):i.$apply(function(){var b=D(a);if(""!==b&&1===h.getButton(a)&&i.task.width>0){var c=g.getOffsetForElement(v[0],a).x;F(b,c),a.stopPropagation(),a.preventDefault()}})}),m.bind("click",function(a){i.$apply(function(){i.gantt.contextMenu=void 0,x||(H(),i.raiseTaskClickedEvent(a,i.task)),a.stopPropagation(),a.preventDefault()})}),m.bind("dblclick",function(a){i.$apply(function(){x||i.raiseTaskDblClickedEvent(a,i.task),a.stopPropagation(),a.preventDefault()})}),m.bind("contextmenu",function(a){i.$apply(function(){i.gantt.jobFlowChart=void 0;var b=[];b=i.gantt.disable===!0?[{key:"flowchart",name:"Show Job Flow"},{key:"info",name:"Show Information"}]:[{key:"pin",name:i.task.isPin===!0?"Unpin":"Pin"},{key:"finished",name:i.task.isFinished===!0?"Finished":"Finish"},{key:"add",name:"Create Task"},{key:"edit",name:"Edit Task"},{key:"flowchart",name:"Show Job Flow"},{key:"info",name:"Show Information"},{key:"divider",name:""},{key:"delete",name:"Delete"}],i.gantt.contextMenu={event:a,type:"task",target:i.task,element:m,items:b},i.raiseTaskContextMenuEvent(a,i.task),a.stopPropagation(),a.preventDefault()})}),m.bind("mousemove",e(function(a){var b=D(a);""!==b&&"M"!==b?m.css("cursor",E(b)):m.css("cursor",""),i.task.mouseX=a.clientX},5)),m.bind("mouseenter",function(a){i.$apply(function(){i.task.mouseX=a.clientX,i.task.isMouseOver=!0})}),m.bind("mouseleave",function(){i.$apply(function(){i.task.isMouseOver=!1})});var y=function(a,b){i.task.isMoving!==!1&&(z(a,b),A(a,b))},z=function(a,b){i.task.mouseOffsetX=b.x;var c=b.x/i.getPxToEmFactor();if("M"===a){if(i.allowTaskRowSwitching){var d=C(b.y);void 0!==d&&d.showup===!0&&d.id!==i.task.row.id&&i.task.row.data.factoryOperation.id===d.data.factoryOperation.id&&d.moveTaskToRow(i.task)}i.allowTaskMoving&&i.task.moveTo(c-n)}else"E"===a?i.task.setTo(c):i.task.setFrom(c);x=!0},A=function(a,b){var d=w[0].scrollLeft,e=!1;if(b.x<o)b.x<=d+t&&(b.x-=s,e=!0,i.scrollLeft(s));else{var f=w[0].offsetWidth,g=d+f;b.x>=g-t&&(b.x+=s,e=!0,i.scrollRight(s))}e&&(p=c(function(){y(a,b)},100,!0))},B=function(){void 0!==p&&(c.cancel(p),p=void 0)},C=function(a){var b=v[0].offsetHeight/i.gantt.rowsCounter,c=Math.floor(a/b);return i.gantt.rows.length===i.gantt.rowsCounter?0===i.gantt.columnPage?i.gantt.rows[c]:i.gantt.rowsMap[i.gantt.columnPagination[i.gantt.columnPage-1][c]]:0===i.gantt.columnPage?i.gantt.rows[1*i.gantt.visibleRows[c]]:i.gantt.rowsMap[i.gantt.columnPagination[i.gantt.columnPage-1][c]]},D=function(a){var b=g.getOffset(a).x,c=0;return i.allowTaskResizing&&(c=m[0].offsetWidth<10?r:q),i.allowTaskResizing&&b>m[0].offsetWidth-c?"E":i.allowTaskResizing&&c>b?"W":(i.allowTaskMoving||i.allowTaskRowSwitching)&&b>=c&&b<=m[0].offsetWidth-c?"M":""},E=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},F=function(a,c){x=!1,i.task.isMoving=!0,o=c;var f=o/i.getPxToEmFactor();n=f-i.task.left;var h=e(function(b){var c=g.getOffsetForElement(v[0],b);B(),y(a,c)},5);d(i,u,"mousemove",h).bind(),d(i,u,"mouseup",function(){i.$apply(function(){u.unbind("mousemove",h),G()})}).bindOnce(),angular.element(b[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:E(a)})},G=function(){i.task.isMoving=!1,B(),m.css("cursor",""),angular.element(b[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),x===!0&&(i.task.row.sortTasks(),i.gantt.showOnProcessing=!0,I(),i.raiseTaskUpdatedEvent(i.task,!0))},H=function(){var a,b,c,d,e,f,g=i.gantt.jobsMap;for(a=0,c=j.keys(g),d=c.length;d>a;++a)for(b=0,e=j.keys(g[c[a]].tasks),f=e.length;f>b;++b)parseInt(c[a],10)===parseInt(i.task.job.id,10)?(g[c[a]].tasks[e[b]].priority=999,g[c[a]].tasks[e[b]].isHighlight=!g[c[a]].tasks[e[b]].isHighlight):(g[c[a]].tasks[e[b]].priority=100,g[c[a]].tasks[e[b]].isHighlight=!1)},I=function(){var a,b,c=i.task,d=i.gantt.jobsMap[c.job.id],e=i.gantt.processesMap[c.process.id];for(a in i.gantt.jobsMap)for(b in i.gantt.jobsMap[a].tasks)i.gantt.jobsMap[a].tasks[b].isHighlight=!1;var g={process:c.process.id,left:c.from-f.clone(c.data.expectedStartTime),right:c.to-f.clone(c.data.expectedFinishTime),today:new Date};c.isParallel===!0?(c.parallelFrom=f.addMilliseconds(c.from,f.clone(c.data.expectedSetupFinishTime)-f.clone(c.data.expectedStartTime),!0),c.parallelFrom=f.addMinutes(c.parallelFrom,c.data.s2sMins)):c.parallelFrom=c.to,c.from<g.today||f.clone(e.tasks[0].from.getTime()+g.left)<g.today,k.run(i.task,i.gantt,function(a){angular.element("#hiddenProcessing").trigger("click"),d.tasks.sort(function(a,b){return a.left-b.left})})};i.task.isMoving&&F("M",i.task.mouseOffsetX)}]}}]),gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(a,b,c,d){var e="";return{restrict:"E",link:function(a){e=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?e+"default.tooltip.tmpl.html":e+b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(e,f){var g=angular.element(b[0].body),h=f.parent();e.visible=!1,e.css={},e.$watch("task.isMouseOver",function(a){a===!0?k(e.task.mouseX):a===!1&&e.task.isMoving===!1&&m()});var i=d(e,g,"mousemove",c(function(a){e.visible===!0?l(a.clientX):k(a.clientX)},1));e.$watch("task.isMoving",function(a){a===!0?i.bind():a===!1&&(i.unbind(),m())});var j=function(){var a=b[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth},k=function(b){e.visible=!0,a(function(){l(b),e.css.top=h[0].getBoundingClientRect().top+"px",e.css.marginTop=-f[0].offsetHeight-8+"px",e.css.opacity=1},1,!0)},l=function(a){f.removeClass("gantt-task-infoArrow"),f.removeClass("gantt-task-infoArrowR"),a+f[0].offsetWidth>j()?(e.css.left=a+20-f[0].offsetWidth+"px",f.addClass("gantt-task-infoArrowR")):(e.css.left=a-20+"px",f.addClass("gantt-task-infoArrow"))},m=function(){e.css.opacity=0,e.visible=!1}}]}}]),gantt.directive("ganttContextMenu",["$window","$document","$timeout",function(a,b){var c="";return{restrict:"E",link:function(a){c=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?c+"default.contentmenu.tmpl.html":c+b.templateUrl},replace:!0,scope:{menu:"=ngModel"},controller:["$scope","$element",function(a){var c=angular.element(b[0].body);c.bind("click",function(){a.$apply(function(){a.$parent.gantt.contextMenu=void 0})}),a.contextMenuLink=function(a,b,c,d){switch(a){case"task":switch(c){case"pin":confirm("Are you sure to "+(b.isPin?"pin":"unpin")+" this Task?")&&(b.isPin=!b.isPin,b.dirty=!0,b.isManual=!0);break;case"finished":b.isFinished===!1&&confirm("Are you sure to finish this Task?")&&confirm("YOU CANNOT REDO THIS ACTION!!!")&&(b.isFinished=!b.isFinished,b.dirty=!0,b.isManual=!0);break;case"add":b.gantt.enableTaskEditor=b.row;break;case"edit":b.gantt.enableTaskEditor=b;break;case"flowchart":b.gantt.jobFlowChart=b.gantt.jobsMap[b.job.id];break;case"info":b.gantt.showTaskInformation=b;break;case"delete":if(confirm("Are you sure to delete this Task?")){b.dirty=!0,b.isDeleted=!0,b.isManual=!0;var e=b.gantt.processesMap[b.process.id],f=[];_.each(e.operations,function(a){a!==b.id&&f.push(a)}),e.operations=f;var g=null;null!==b.previousOperation&&void 0!==b.gantt.tasksMap[b.previousOperation]&&(g=b.gantt.tasksMap[b.previousOperation].id),b.nextOperations.length>0&&_.each(b.nextOperations,function(a){var c=b.gantt.tasksMap[a];parseInt(c.previousOperation,10)===parseInt(b.id,10)&&(c.previousOperation=g)}),d.remove()}}break;case"row":"add"===c&&(b.gantt.enableTaskEditor=b)}}}]}}]),gantt.factory("debounce",["$timeout",function(a){function b(b,c){var d=0;return function(){var e=this,f=arguments;d++;var g=function(a){return function(){return a===d?b.apply(e,f):void 0}}(d);return a(g,c,!0)}}return b}]),gantt.directive("ganttDepartment",["$timeout","$document","debounce","smartEvent","_",function(a,b,c,d,e){function f(a){for(var b=[],c=[],d=function(a,b){return a.sortBy-b.sortBy},f=0,g=e.keys(a),h=g.length;h>f;f++)if(void 0!==a[g[f]]){if(c=[],e.keys(a[g[f]].sub).length>0){for(var i=0,j=e.keys(a[g[f]].sub),k=j.length;k>i;i++)c.push({name:j[i],sortBy:a[g[f]].sub[j[i]].sortBy,rows:a[g[f]].sub[j[i]].rows});
c.sort(d)}b.push({name:g[f],sortBy:a[g[f]].sortBy,sub:c,rows:a[g[f]].rows})}return b.sort(d),b}var g="";return{restrict:"E",link:function(a){g=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?g+"default.department.tmpl.html":g+b.templateUrl},replace:!0,scope:{dept:"=ngModel"},controller:["$scope","$element",function(a){var b=-1,c=-1;a.departmentMap=[],a.$watch("dept",function(b){a.departmentMap=f(b),a.ganttDepartmentFilter=-1,a.ganttSubDepartmentFilter=-1}),a.columnPage=a.$parent.gantt.columnPage,a.$watch("ganttDepartmentFilter",function(c,e){angular.equals(c,e)||(b=parseInt(c,10),a.ganttSubDepartmentFilter=-1,d())}),a.$watch("ganttSubDepartmentFilter",function(a,b){angular.equals(a,b)||(c=parseInt(a,10),d())}),a.previousColumnPage=function(){if("-1"===b||-1===b||void 0===b){a.$parent.gantt.columnPage>1&&a.$parent.gantt.columnPage--,a.columnPage=a.$parent.gantt.columnPage,a.$parent.gantt.rowsCounter=a.$parent.gantt.columnPagination[a.columnPage-1].length,a.$parent.gantt.visibleRows=[];for(var c=0,d=e.keys(a.$parent.gantt.rows),f=d.length;f>c;++c)a.$parent.gantt.columnPagination[a.columnPage-1].indexOf(a.$parent.gantt.rows[d[c]].id)>=0&&a.$parent.gantt.visibleRows.push(d[c])}},a.nextColumnPage=function(){if("-1"===b||-1===b||void 0===b){a.$parent.gantt.columnPage<a.$parent.gantt.columnPagination.length&&a.$parent.gantt.columnPage++,a.columnPage=a.$parent.gantt.columnPage,a.$parent.gantt.rowsCounter=a.$parent.gantt.columnPagination[a.columnPage-1].length,a.$parent.gantt.visibleRows=[];for(var c=0,d=e.keys(a.$parent.gantt.rows),f=d.length;f>c;++c)a.$parent.gantt.columnPagination[a.columnPage-1].indexOf(a.$parent.gantt.rows[d[c]].id)>=0&&a.$parent.gantt.visibleRows.push(d[c])}};var d=function(){var d,f,g,h,i,j=0;if(a.columnPage=1,a.$parent.gantt.visibleRows=[],console.log(a.departmentMap,b,c),"-1"===b||-1===b||void 0===b){for(d in a.departmentMap)for(f=0,h=a.departmentMap[d].rows.length;h>f;f++)a.departmentMap[d].rows[f].showup=!0,j++;a.$parent.gantt.columnPage=1}else if(a.$parent.gantt.columnPage=0,void 0===c||"-1"===c||-1===c)for(d=0,i=a.departmentMap.length;i>d;d++)for(f=0,h=a.departmentMap[d].rows.length;h>f;f++)d!==b?a.departmentMap[d].rows[f].showup=!1:(a.departmentMap[d].rows[f].showup=!0,j++);else for(f=0,i=a.departmentMap[b].sub.length;i>f;f++)for(g=0,h=a.departmentMap[b].sub[f].rows.length;h>g;g++)f!==c?a.departmentMap[b].sub[f].rows[g].showup=!1:(a.departmentMap[b].sub[f].rows[g].showup=!0,j++);for(d=0,g=e.keys(a.$parent.gantt.rows),h=g.length;h>d;++d)a.$parent.gantt.rows[g[d]].showup===!0&&a.$parent.gantt.visibleRows.push(g[d]);a.$parent.gantt.rowsCounter=j}}]}}]),gantt.directive("ganttJobFlowchart",["$window","$document","$timeout","_","coloured",function(a,b,c,d,e){var f="";return{restrict:"E",link:function(a){f=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?f+"default.flowchart.tmpl.html":f+b.templateUrl},replace:!0,scope:{job:"=ngModel"},controller:["$scope","$element",function(c){var f,g,h,i,j,k,l,m,n,o,p=(angular.element(b[0].body),d3.select("#gantt-job-flowchart-svg g")),q=20,r=new graphlib.CDigraph,s=new dagreD3.Renderer,t={},u=function(a,b){return a.foo-b.foo},v={},w=c.$parent.gantt.tasksMap,x=c.$parent.gantt.processesMap,y={};c.css={height:"100%"};var z=c.job.tasks;for(g=0,h=z,j=h.length;j>g;++g)if(y[h[g].id.toString()]=h[g].color,h[g].process.id in t||(t[h[g].process.id]=[],r.addNode(h[g].process.id.toString(),{label:"Process "+h[g].process.id.toString()}),f!==h[g].process.id&&(void 0!==f&&r.hasNode(f+"_last")===!1&&(r.addNode(f+"_last",{label:""}),r.parent(f+"_last",f.toString())),r.hasNode(h[g].process.id+"_first")===!1&&(r.addNode(h[g].process.id+"_first",{label:""}),r.parent(h[g].process.id+"_first",h[g].process.id.toString()),f=h[g].process.id))),h[g].isDeleted===!0);else{var A=[],B="                        ";A.push("process id: "+h[g].process.id),A.push("task id: "+h[g].data.id),A.push("previous task id: "+h[g].data.previousOperation),A.push("next tasks: "+h[g].data.nextOperations),A.push("========================"),A.push("PO#: "+h[g].job.poNo),A.push("PO QTY: "+h[g].job.comboQuantity),A.push(B);var C=h[g].data.processingType,D="",E="";"GANG"===C?(D="Gang#: ",E="Gang QTY: "):"JOB"===C?(D="Job#: ",E="Job QTY: "):"JOB_FILE"===C&&(D="Job file#: ",E="Job file QTY: "),A.push("Job Style: "+h[g].data.processingType),A.push(D+h[g].data.operationCode),A.push(E+h[g].data.quantity),A.push(B),A.push("Run on Machine: "+h[g].row.description),A.push(B),A.push("Start time: "+moment(h[g].from).format("YYYY-MM-DD hh:mm")),A.push("Finish time: "+moment(h[g].to).format("YYYY-MM-DD hh:mm")),A.push("Duration: "+((h[g].to-h[g].from)/1e3/60/60).toFixed(2)+" (hrs)"),A.push(B),A.push("Finished: "+(h[g].isFinished===!0?"Y":"N")),A.push("Pin: "+(h[g].isPin===!0?"Y":"N")),A.push("In Processing: "+(h[g].inProcessing===!0?"Y":"N")),A.push(B),A=A.join("\n"),r.addNode(h[g].id.toString(),{label:A,color:h[g].data.color2.replace("0x","#")}),t[h[g].process.id].push({id:h[g].id.toString(),previous:h[g].previousOperation,next:h[g].nextOperations,foo:1*h[g].data.factoryOperation.priority,processId:1*h[g].process.id,order:h[g].to.getTime()})}for(g=0,h=z,j=h.length;j>g;++g)r.hasNode(h[g].id.toString())&&r.hasNode(h[g].process.id.toString())&&r.parent(h[g].id.toString(),h[g].process.id.toString());for(g=0,i=d.keys(t),j=i.length;j>g;++g)for(t[i[g]].sort(u),k=0,l=t[i[g]],m=l.length;m>k;++k)v[i[g]]=i[g]in v?d.union(v[i[g]],[l[k].foo]):[l[k].foo];for(g=0,i=d.keys(t),j=i.length;j>g;++g)for(k=0,l=t[i[g]],m=l.length;m>k;++k)if(1===v[i[g]].length)r.hasNode(i[g]+"_last")&&r.addEdge(null,l[k].id.toString(),i[g]+"_last",{}),r.hasNode(i[g]+"_first")&&l[k].foo===l[0].foo&&r.addEdge(null,i[g]+"_first",l[k].id.toString(),{});else if(r.hasNode(l[k].id.toString())&&r.hasNode(l[k].previous)){if(r.addEdge(null,l[k].previous,l[k].id.toString(),{}),l[k].foo===l[m-1].foo&&r.hasNode(i[g]+"_last"))if(l[k].next.length>0)for(n=0,o=l[k].next;n<o.length;++n)r.hasNode(o[n].toString())||r.addEdge(null,l[k].id.toString(),i[g]+"_last",{});else{var F=!0;for(n=0,o=t[l[k].processId];n<o.length;++n)if(r.hasNode(o[n].id)&&o[n].previous===l[k].id.toString()){F=!1;break}F&&r.addEdge(null,l[k].id.toString(),i[g]+"_last",{})}}else(l[k].foo===l[0].foo||r.hasNode(l[k].previous===!1))&&r.hasNode(i[g]+"_first")&&r.addEdge(null,i[g]+"_first",l[k].id.toString(),{});var G=function(a){var b=c.$parent.gantt.processesMap,e=[];if(void 0===a)return[];for(a.previous.sort(function(a,b){return b-a}),h=0,k=a.previous,l=k.length;l>h;++h)r.hasNode(k[h].toString())?e.push(k[h].toString()):e=d.union(e,G(b[k[h]]));return e};for(g=0,i=d.keys(t),j=i.length;j>g;++g)if(r.hasNode(i[g].toString()+"_first")&&(t[i[g]].sort(u),(previousProcesses=G(x[i[g]]))!==!1&&previousProcesses.length>0))for(h=0,k=previousProcesses,l=k.length;l>h;++h)r.addEdge(null,k[h]+"_last",i[g]+"_first",{});x=void 0,t=void 0,f=void 0,u=void 0,v=void 0,w=void 0;var H=s.postRender(),I=function(a,b){return"children"in a&&a.children(b).length},J=function(a,b,c,d){var f=a.label,g=b.append("rect"),h=b.append("g");K(f,h,Math.floor(a.labelCols),a.labelCut);var i=b.node().getBBox();h.attr("transform","translate("+-i.width/2+","+-i.height/2+")");var j=void 0!==a.color&&""!==a.color&&a.color||"#ffffff",k=e.isDarkColoured(j.replace("#",""))?"#ffffff":"#000000";b.attr("fill",k),g.attr("rx",5).attr("ry",5).attr("x",-(i.width/2+c)).attr("y",-(i.height/2+d)).attr("width",i.width+2*c).attr("height",i.height+2*d).attr("style","fill: "+j)},K=function(a,b,c,d){void 0===d&&(d="false"),d="true"===d.toString().toLowerCase();var e=b.append("text").attr("text-anchor","left");a=a.replace(/\\n/g,"\n");var f=c?L(a,c,d):a;f=f.split("\n");for(var g=0;g<f.length;g++)e.append("tspan").attr("dy","1.5em").attr("x","1").text(f[g])},L=function(a,b,c,d){if(d=d||"\n",b=b||75,c=c||!1,!a)return a;var e=".{1,"+b+"}(\\s|$)"+(c?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)");return a.match(new RegExp(e,"g")).join(d)};s.drawNodes(function(a,b){var c=a.children(null),d=b.selectAll("g.cluster").data(c,function(a){return a});d.selectAll("*").remove(),d.enter().append("g").classed("cluster",!0),d.each(function(b){var c=a.nodes().filter(function(c){return!I(a,c)&&a.parent(c)===b}),d=d3.select(this),e=d.selectAll("g.node").classed("enter",!1).data(c,function(a){return a});e.selectAll("*").remove(),e.enter().append("g").style("opacity",0).attr("class","node enter"),e.each(function(b){J(a.node(b),d3.select(this),10,10)})});var e=b.selectAll("g.node");return e});var M=[];s.postRender(function(a,b){var c=(new graphlib.CDigraph,a.children(null),a.nodes(),b.selectAll("g.cluster"));c.each(function(a){{var b=d3.select(this),c=b.node().getBBox();-(c.width/2+q/2),-(c.height/2+q/2)}b.insert("rect",":first-child").attr("id",a).attr("x",c.x-q/2).attr("y",c.y-q/2).attr("width",c.width+q).attr("height",c.height+q).attr("fill","#ffffff").attr("stroke","black").attr("stroke-width","1.5px").style("opacity",.6),M.push({id:a,x:c.x-q/2,y:c.y-q/2,w:c.width+q,h:c.height+q})}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var d=p.select("g.edgeLabels"),e=p.select("g.edgePaths");d.moveToFront(),e.moveToFront(),H(a,b)}),s.edgeInterpolate("monotone");var N=dagreD3.layout().nodeSep(50).rankSep(100).edgeSep(50).rankDir("LR");N=s.layout(N).run(r,p),N.graph().width+40<a.innerWidth?d3.select("#gantt-job-flowchart-svg").attr("width",N.graph().width+40):d3.select("#gantt-job-flowchart-svg").attr("width",a.innerWidth),N.graph().height+40<a.innerHeight-160?d3.select("#gantt-job-flowchart-svg").attr("height",N.graph().height+40):d3.select("#gantt-job-flowchart-svg").attr("height",a.innerHeight-160);var O=0,P=0,Q=a.innerWidth/N.graph().width;Q=.1>Q?10*Q:Q>1?1:Q;var R=0,S=0;for(g=0,i=M,k=i.length;k>g;g++)i[g].h>S&&(S=i[g].h,R=Math.abs(i[g].x-i[g].w));P=S*Q/2*-1+a.innerHeight/2,O=-1*R*Q+a.innerWidth/2,p.attr("transform","translate("+O+","+P+") scale("+Q+")")}]}}]),gantt.factory("keepScrollPos",["$timeout",function(a){function b(b,c){return function(){var d=b.ganttScroll[0],e=d.scrollLeft,f=b.gantt.getFirstColumn(),g=b.getPxToEmFactor();c.apply(this,arguments),f=void 0===f?0:b.gantt.getColumnByDate(f.date).left*g,d.scrollLeft=f+e,d.scrollLeft!=f+e&&a(function(){d.scrollLeft=f+e},0,!1)}}return b}]),gantt.directive("ganttMachineTasks",["$window","$document","$timeout","debounce","dateFunctions","taskWorker","_","coloured",function(a,b,c,d,e,f,g,h){var i="";return{restrict:"E",link:function(a){i=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?i+"default.tasksonmachine.tmpl.html":i+b.templateUrl},replace:!0,controller:["$scope","$element",function(a,d){{var g,i,j;angular.element(b[0].body)}for(a.machine=a.gantt.tasksOnMachine,g=0,i=a.machine.tasks,j=i.length;j>g;++g)i[g].editorFrom=moment(i[g].from).format("YYYY-MM-DDTHH:mm"),i[g].editorTo=moment(i[g].to).format("YYYY-MM-DDTHH:mm"),i[g].editorDuring=(i[g].to-i[g].from)/6e4;a.extentionTh=a.machine.data.title.split("|"),a.css=function(a){return{background:a,color:h.isDarkColoured(a.replace("#",""))?"#ffffff":"#000000"}};var k=[];a.tableWidth=function(){return k.push(angular.element("#tree-node-table-header").width()),k.length>1?{width:Math.max.apply(Math,k)+"px"}:void 0};var l=function(b){var c=a.gantt.tasksMap[angular.element(b.currentTarget).data("task-id")];a.gantt.tooltipTaskOnMachine={css:{x:b.clientX+220>d[0].clientWidth?d[0].clientWidth-220:b.clientX,y:b.clientY+150>d[0].clientHeight?d[0].clientHeight-150:b.clientY},title:c.id,header:a.extentionTh,data:c.tooltips.ui,task:c,element:angular.element(b.currentTarget)},b.stopPropagation(),b.preventDefault()},m=function(){a.$parent.gantt.tooltipTaskOnMachine=void 0};c(function(){console.log("fire");for(var a=0,b=d.find("tr.machine-task-node"),c=b.length;c>a;++a)angular.element(b[a]).bind("mousedown",d,m),angular.element(b[a]).bind("contextmenu",d,l)},10);var n=function(b){f.run(b,a.gantt,function(b){for(b===!1&&console.log(b),a.machine.tasks.sort(function(a,b){return a.from-b.from}),g=0,i=a.machine.tasks,j=i.length;j>g;++g)i[g].editorFrom=moment(i[g].from).format("YYYY-MM-DDTHH:mm"),i[g].editorTo=moment(i[g].to).format("YYYY-MM-DDTHH:mm"),i[g].editorDuring=(i[g].to-i[g].from)/6e4;angular.element("#hiddenProcessing").trigger("click")})};a.changeTaskFrom=function(b,c,d,f){var g=d-c;f=e.clone(f+":00.000"),f-e.setSecondsZero(c,!0)!==0&&(a.gantt.showOnProcessing=!0,a.machine.tasksMap[b].to=e.addMilliseconds(f,g,!0),a.machine.tasksMap[b].parallelFrom=e.addMilliseconds(f,a.gantt.tasksMap[b].parallelFrom-a.gantt.tasksMap[b].from,!0),a.machine.tasksMap[b].from=f,a.machine.tasksMap[b].editorTo=moment(a.machine.tasksMap[b].to).format("YYYY-MM-DDTHH:mm"),a.machine.tasksMap[b].editorDuring=(a.machine.tasksMap[b].to-f)/6e4,n(a.machine.tasksMap[b]))},a.changeTaskTo=function(b,c,d,f){var g=d-c;f=e.clone(f+":00.000"),f-e.setSecondsZero(d,!0)!==0&&(a.gantt.showOnProcessing=!0,a.machine.tasksMap[b].from=e.addMilliseconds(f,-1*g,!0),a.machine.tasksMap[b].parallelFrom=e.addMilliseconds(f,a.gantt.tasksMap[b].parallelFrom-a.gantt.tasksMap[b].to,!0),a.machine.tasksMap[b].to=f,a.machine.tasksMap[b].editorFrom=moment(a.machine.tasksMap[b].from).format("YYYY-MM-DDTHH:mm"),a.machine.tasksMap[b].editorDuring=(f-a.machine.tasksMap[b].from)/6e4,n(a.machine.tasksMap[b]))},a.changeTaskDuring=function(b,c,d,f){var g=(d-c)/6e4;f!==g&&(a.gantt.showOnProcessing=!0,a.machine.tasksMap[b].from=e.addMinutes(a.machine.tasksMap[b].from,f-g,!0),a.machine.tasksMap[b].parallelFrom=e.addMinutes(a.machine.tasksMap[b].parallelFrom,f-g,!0),a.machine.tasksMap[b].to=e.addMinutes(a.machine.tasksMap[b].to,f-g,!0),a.machine.tasksMap[b].editorFrom=moment(a.machine.tasksMap[b].from).format("YYYY-MM-DDTHH:mm"),a.machine.tasksMap[b].editorTo=moment(a.machine.tasksMap[b].to).format("YYYY-MM-DDTHH:mm"),n(a.machine.tasksMap[b]))},a.changeTaskPin=function(b){a.machine.tasksMap[b].isPin=!a.machine.tasksMap[b].isPin},a.treeOptions={beforeDrag:function(){return a.gantt.tooltipTaskOnMachine=void 0,a.gantt.disable===!0?!1:!0},dropped:function(b){var c=b.source,d=(c.nodeScope.task,b.dest);if(d.index-1>=0&&d.index!==c.index){a.gantt.showOnProcessing=!0;var f=a.gantt.tasksOnMachine.tasks[d.index-1],g=a.gantt.tasksOnMachine.tasks[c.index];g.to=e.addMilliseconds(e.addMinutes(f.to,1,!0),g.to-g.from,!0),g.parallelFrom=e.addMilliseconds(e.addMinutes(f.to,1,!0),g.parallelFrom-g.from,!0),g.from=e.addMinutes(f.to,1,!0),n(g)}}}}]}}]),gantt.service("mouseButton",[function(){return{getButton:function(a){return a=a||window.event,a.which?a.which:a.button<2?1:4==a.button?2:3}}}]),gantt.service("mouseOffset",[function(){return{getOffset:function(a){return a.offsetX&&a.offsetY?{x:a.offsetX,y:a.offsetY}:a.layerX&&a.layerY?{x:a.layerX,y:a.layerY}:this.getOffsetForElement(a.target,a)},getOffsetForElement:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}}}]),gantt.factory("smartEvent",[function(){function a(a,b,c,d){return a.$on("$destroy",function(){b.unbind(c,d)}),{bindOnce:function(){b.one(c,d)},bind:function(){b.bind(c,d)},unbind:function(){b.unbind(c,d)}}}return a}]),gantt.directive("ganttTaskEditor",["$window","$document","$timeout","dateFunctions","taskWorker","_",function(a,b,c,d,e,f){var g="";return{restrict:"E",link:function(a){g=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?g+"gantt.taskEditor.tmpl.html":g+b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element","$http","$q",function(a,c,g,h){function i(b){var c=b.headers("Content-Type").replace(/;(.*)$/gi,"");if("application/json"===c){switch(b.config.data){case"poFuzzySearch":a.poFuzzySearch=b.data.data,o.css("display","block");break;case"getPoUrl":a.editTask.poId=b.data.data.id;break;case"getComboUrl":for(a.editTask.comboList=b.data.data,k=0,l=f.keys(a.$parent.gantt.jobsMap),m=l.length;m>k;++k)a.$parent.gantt.jobsMap[l[k]].poNo===a.editTask.poNo&&(a.editTask.job=a.$parent.gantt.jobsMap[l[k]]);break;case"getProductUrl":a.editTask.productList=b.data.data;break;case"getProcessUrl":a.editTask.processList=b.data.data;break;case"getProductInfoUrl":a.editTask.comboList=[{label:b.data.data.comboId,value:b.data.data.comboId}],a.editTask.productList=[{label:b.data.data.productId,value:b.data.data.productId}],a.editTask.comboId=b.data.data.comboId,a.editTask.productId=b.data.data.productId,a.editTask.poNo=b.data.data.poNo,a.editTask.poId=b.data.data.poNo;break;default:return h.reject("Response type is not JSON.")}return b.data}switch(b.config.data){case"poFuzzySearch":for(a.poFuzzySearch=[],k=0,l=f.keys(a.$parent.gantt.jobsMap),m=l.length;m>k;++k)a.poFuzzySearch.push({label:a.$parent.gantt.jobsMap[l[k]].poNo,value:a.$parent.gantt.jobsMap[l[k]].poNo});o.css("display","block");break;case"getPoUrl":a.editTask.poId=a.editTask.poNo;break;case"getComboUrl":for(a.editTask.comboList=[],k=0,l=f.keys(a.$parent.gantt.jobsMap),m=l.length;m>k;++k)a.$parent.gantt.jobsMap[l[k]].poNo===a.editTask.poNo&&(a.editTask.comboList.push({label:a.$parent.gantt.jobsMap[l[k]].comboId,value:a.$parent.gantt.jobsMap[l[k]].comboId}),a.editTask.job=a.$parent.gantt.jobsMap[l[k]]);break;case"getProductUrl":for(a.editTask.productList=[],k=0,l=f.keys(a.$parent.gantt.processesMap),m=l.length;m>k;++k){var d=null===a.$parent.gantt.processesMap[l[k]].productId?"product-null":a.$parent.gantt.processesMap[l[k]].productId;a.editTask.productList.push({label:d,value:d})}break;case"getProcessUrl":for(a.editTask.processList=[],k=0,l=f.keys(a.$parent.gantt.processesMap),m=l.length;m>k;++k)(null===a.$parent.gantt.processesMap[l[k]].productId||a.$parent.gantt.processesMap[l[k]].productId===a.editTask.productId)&&a.editTask.processList.push({label:a.$parent.gantt.processesMap[l[k]].id,value:a.$parent.gantt.processesMap[l[k]].id});break;case"getProductInfoUrl":break;default:return h.reject("Response type is not JSON.")}return h.reject("Response type is not JSON.")}function j(b){switch(b.config.data){case"poFuzzySearch":for(a.poFuzzySearch=[],k=0,l=f.keys(a.$parent.gantt.jobsMap),m=l.length;m>k;++k)a.poFuzzySearch.push({label:a.$parent.gantt.jobsMap[l[k]].poNo,value:a.$parent.gantt.jobsMap[l[k]].poNo});o.css("display","block");break;case"getPoUrl":a.editTask.poId=a.editTask.poNo;break;case"getComboUrl":for(a.editTask.comboList=[],k=0,l=f.keys(a.$parent.gantt.jobsMap),m=l.length;m>k;++k)a.$parent.gantt.jobsMap[l[k]].poNo===a.editTask.poNo&&(a.editTask.comboList.push({label:a.$parent.gantt.jobsMap[l[k]].comboId,value:a.$parent.gantt.jobsMap[l[k]].comboId}),a.editTask.job=a.$parent.gantt.jobsMap[l[k]]);break;case"getProductUrl":for(a.editTask.productList=[],k=0,l=f.keys(a.$parent.gantt.processesMap),m=l.length;m>k;++k)a.editTask.productList.push({label:a.$parent.gantt.processesMap[l[k]].productId,value:a.$parent.gantt.processesMap[l[k]].productId});break;case"getProcessUrl":for(a.editTask.processList=[],k=0,l=f.keys(a.$parent.gantt.processesMap),m=l.length;m>k;++k)a.$parent.gantt.processesMap[l[k]].productId===a.editTask.productId&&a.editTask.processList.push({label:a.$parent.gantt.processesMap[l[k]].id,value:a.$parent.gantt.processesMap[l[k]].id});break;case"getProductInfoUrl":}return h.reject(angular.isObject(b.data)&&b.data.message?b.data.message:"An unknown error occurred.")}var k,l,m,n=(angular.element(b[0].body),a.$parent.gantt.ajaxUrl);a.disableTaskEditor=function(){a.$parent.gantt.enableTaskEditor=void 0},a.shiftTaskPriority=function(b){for(a.editTask.priority=b+1,k=0,l=a.editTask.job.tasks,m=l.length;m>k;++k)l[k].priority>=a.editTask.priority&&(l[k].priority=l[k].priority+1,l[k].data.priority=l[k].priority)},a.saveTaskEditor=function(){var b=a.editTask,c=!0,f="";if(b.rowId=void 0===b.rowId?0:b.rowId,b.taskId=void 0===b.taskId||0===b.taskId?Object.keys(a.$parent.gantt.tasksMap).length+1e6:b.taskId,b.poNo=void 0===b.poNo?"object"==typeof a.task&&"Task"===a.task.name?a.task.job.poNo:null:b.poNo,b.comboId=void 0===b.comboId?"object"==typeof a.task&&"Task"===a.task.name?a.task.job.comboId:null:b.comboId,b.operationCode=void 0===b.operationCode?"object"==typeof a.task&&"Task"===a.task.name?a.task.operationCode:null:b.operationCode,b.processId=void 0===b.processId?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.processId:0:b.processId,b.productId=void 0===b.productId?"object"==typeof a.task&&"Task"===a.task.name?a.task.process.productId:0:b.productId,b.processingType=void 0===b.processingType?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.processingType:null:b.processingType,b.previousTask=void 0===b.previousTask?null:b.previousTask,b.nextTask=void 0===b.nextTask?[]:[b.nextTask],b.priority=void 0===b.priority?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.priority:0:b.priority,b.quantity=void 0===b.quantity?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.quantity:0:b.quantity,b.sheetUp=void 0===b.sheetUp?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.sheetUp:0:b.sheetUp,b.up=void 0===b.up?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.up:0:b.up,b.isPin=void 0===b.isPin?"object"==typeof a.task&&"Task"===a.task.name?a.task.isPin:!1:!!b.isPin,b.isParallel=void 0===b.isParallel?"object"==typeof a.task&&"Task"===a.task.name?a.task.isParallel:!1:!!b.isParallel,b.inProcessing=void 0===b.inProcessing?"object"==typeof a.task&&"Task"===a.task.name?a.task.inProcessing:!1:!!b.inProcessing,b.parallelCode=void 0===b.parallelCode?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.parallelCode:null:b.parallelCode,b.s2sMins=void 0===b.s2sMins?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.s2sMins:-1:b.s2sMins,b.timeclockEmployeeId=void 0===b.timeclockEmployeeId?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.timeclockEmployeeId:null:b.timeclockEmployeeId,b.expectedStartTime=void 0===b.expectedStartTime?"object"==typeof a.task&&"Task"===a.task.name?a.task.from:null:b.expectedStartTime,b.expectedSetupFinishTime=void 0===b.expectedSetupFinishTime?"object"==typeof a.task&&"Task"===a.task.name?d.addMilliseconds(d.clone(a.task.data.expectedSetupFinishTime),a.task.to-a.task.from,!0):null:b.expectedSetupFinishTime,b.expectedFinishTime=void 0===b.expectedFinishTime?"object"==typeof a.task&&"Task"===a.task.name?a.task.to:null:b.expectedFinishTime,b.actualStartTime=void 0===b.actualStartTime?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.actualStartTime:null:b.actualStartTime,b.actualSetupFinishTime=void 0===b.actualSetupFinishTime?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.actualSetupFinishTime:null:b.actualSetupFinishTime,b.actualFinishTime=void 0===b.actualFinishTime?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.actualFinishTime:null:b.actualFinishTime,b.actualQuantity=void 0===b.actualQuantity?"object"==typeof a.task&&"Task"===a.task.name?a.task.data.actualQuantit:null:b.actualQuantity,(null===b.poNo||null===b.comboId||null===b.processId||null===b.processingType||null===b.quantity||null===b.priority||null===b.expectedStartTime||null===b.expectedSetupFinishTime||null===b.expectedFinishTime)&&(c=!1,f="1"),"GANG"!==b.processingType||null!==b.up&&null!==b.sheetUp||(c=!1,f="2"),b.isParallel===!0&&null===b.parallelCode&&(c=!1,f="3"),b.isPin!==!0||null!==b.expectedStartTime&&null!==b.expectedSetupFinishTime&&null!==b.expectedFinishTime&&null!==b.quantity||(c=!1,f="4"),b.inProcessing!==!0||null!==b.expectedStartTime&&null!==b.expectedSetupFinishTime&&null!==b.expectedFinishTime&&null!==b.actualStartTime&&null!==b.actualSetupFinishTime&&null!==b.actualFinishTime&&null!==b.actualQuantity||(c=!1,f="5"),c===!1||0===b.rowId)alert("Data check failed!");else{var g=a.$parent.gantt.processesMap[b.processId];g.operations.push(b.taskId);var h={id:b.taskId,oid:b.taskId,part:0,operationCode:b.operationCode,priority:b.priority,job:{id:a.editTask.job.id,poNo:a.editTask.job.poNo,comboId:a.editTask.job.comboId,comboType:a.editTask.job.comboType,comboQuantity:a.editTask.job.comboQuantity},process:{id:b.processId,needWaitPrevProcess:g.waitPrevious,operations:g.operations,previousProcesses:g.previous,productId:b.productId},previousOperation:b.previousTask,nextOperations:b.nextTask,runOnMachineId:b.rowId,actualRunOnMachineId:null,quantity:b.quantity,actualQuantity:0,processingType:b.processingType,factoryOperation:a.editTask.factoryOperation,jobFile:null,manual:!0,pin:b.isPin,setupTime:(d.clone(b.expectedSetupFinishTime)-d.clone(b.expectedStartTime))/1e3/60,productionTime:(d.clone(b.expectedFinishTime)-d.clone(b.expectedStartTime))/1e3/60,productionCapacity:0,s2sMins:b.s2sMins,up:b.up,sheetUp:b.sheetUp,expectedStartTime:b.expectedStartTime+":00.000",expectedSetupFinishTime:b.expectedSetupFinishTime+":00.000",expectedFinishTime:b.expectedFinishTime+":00.000",actualStartTime:null===b.actualStartTime?null:b.actualStartTime+":00.000",actualSetupFinishTime:null===b.actualSetupFinishTime?null:b.actualSetupFinishTime+":00.000",actualFinishTime:null===b.actualFinishTime?null:b.actualFinishTime+":00.000",finished:b.isFinish,inProcessing:b.inProcessing,"delete":!1,parallel:b.isParallel,parallelCode:b.parallelCode,expectedMoldId:null,tooltip1:b.operationCode+"|"+b.comboId+"|"+b.poNo,tooltip2:b.operationCode+"|"+b.comboId+"|"+b.poNo,tooltip3:b.operationCode+"|"+b.comboId+"|"+b.poNo,color1:"0xffff00",color2:"",timeclockEmployeeId:null,"new":!0},i=a.$parent.gantt.rowsMap[b.rowId],j=i.addTask(h);i.setMinMaxDateByTask(j),j.updatePosAndSize(),j.checkIfMilestone(),a.$parent.gantt.showOnProcessing=!0,e.run(j,a.$parent.gantt,function(b,c,d){if(b===!0){if("New"===a.editTask.type){var e=[];for(k=0,l=g.operations,m=l.length;m>k;++k)l[k]!==d.taskId&&e.push(l[k]);for(a.$parent.gantt.processesMap[d.processId].operations=e,k=0,l=a.$parent.gantt.processesMap[d.processId].tasks,m=l.length;m>k;++k)if(l[k].id===d.taskId){unset(a.$parent.gantt.processesMap[d.processId].tasks[k]);break}for(unset(a.$parent.gantt.rowsMap[d.rowId].tasksMap[d.taskId]),unset(a.$parent.gantt.tasksMap[d.taskId]),k=0,l=a.editTask.job.tasks,m=l.length;m>k;++k)if(l[k].id===d.taskId){unset(a.editTask.job.tasks[k]);break}}}else a.$parent.gantt.expandDefaultDateRange(j.from,j.to),alert("Congratulations!!"),a.disableTaskEditor(),angular.element("#hiddenProcessing").trigger("click")})}};var o=angular.element("#modifyTask_poNo_dropdown");a.toggleFuzzyDropdown=function(b){o.css("display","none"),void 0!==b&&(a.editTask.fuzzyPoNo=b,a.editTask.poNo=b)},a.poFuzzySearch=[];var p=null;if(a.editTask={type:"New",rowId:a.task.id,taskId:0,job:{},poNo:"",fuzzyPoNo:"",operationCode:"",comboId:"",productId:"",processId:"",comboList:[],productList:[],processList:[],processingType:"GANG",factoryOperation:{},priority:0,quantity:0,sheetUp:0,up:0,isPin:!1,isParallel:!1,isFinished:!1,inProcessing:!1,parallelCode:"",s2sMins:-1,timeclockEmployeeId:0,runOnMachineId:a.task.id,expectedStartTime:null,expectedSetupFinishTime:null,expectedFinishTime:null,actualStartTime:null,actualSetupFinishTime:null,actualFinishTime:null,actualQuantity:0,actualRunOnMachineId:a.task.id},"object"==typeof a.task&&"Task"===a.task.name){a.editTask=a.task,a.editTask={type:"Edit",rowId:a.task.row.id,taskId:a.task.id,poNo:a.task.data.job.poNo,FuzzyPoNo:a.task.data.job.poNo,comboList:[{label:a.task.data.job.comboId,value:a.task.data.job.comboId}],comboId:a.task.data.job.comboId,operationCode:a.task.operationCode,processList:[{label:a.task.data.process.id,value:a.task.data.process.id}],processId:a.task.data.process.id,productList:[{label:a.task.data.process.productId,value:a.task.data.process.productId}],productId:a.task.data.process.productId,processingType:a.task.data.processingType,job:a.task.data.job,factoryOperation:a.task.row.data.factoryOperation,priority:a.task.data.priority,quantity:a.task.data.quantity,sheetUp:a.task.data.sheetUp,up:a.task.data.up,isPin:a.task.isPin,isFinished:a.task.isFinished,isParallel:a.task.isParallel,inProcessing:a.task.inProcessing,parallelCode:a.task.data.parallelCode,s2sMins:a.task.data.s2sMins||-1,timeclockEmployeeId:a.task.data.timeclockEmployeeId,expectedStartTime:moment(a.task.from).format("YYYY-MM-DDTHH:mm"),expectedSetupFinishTime:moment(d.addMilliseconds(d.clone(a.task.data.expectedSetupFinishTime),a.task.to-a.task.from,!0)).format("YYYY-MM-DDTHH:mm"),expectedFinishTime:moment(a.task.to).format("YYYY-MM-DDTHH:mm"),runOnMachineId:a.task.row.id,actualStartTime:null===a.task.data.actualStartTime||""===a.task.data.actualStartTime?"":moment(d.clone(a.task.data.actualStartTime)).format("YYYY-MM-DDTHH:mm"),actualSetupFinishTime:null===a.task.data.actualSetupFinishTime||""===a.task.data.actualSetupFinishTime?"":moment(d.clone(a.task.data.actualSetupFinishTime)).format("YYYY-MM-DDTHH:mm"),actualFinishTime:null===a.task.data.actualFinishTime||""===a.task.data.actualFinishTime?"":moment(d.clone(a.task.data.actualFinishTime)).format("YYYY-MM-DDTHH:mm"),actualQuantity:a.task.data.actualQuantity,actualRunOnMachineId:a.task.row.id},null!==p&&clearTimeout(p);{g({method:"get",responseType:"json",url:n.serverLocation+n.getProductInfoUrl.replace("#taskId#",a.task.id),data:"getProductInfoUrl"}).then(i,j)}}else"object"==typeof a.task&&"Row"===a.task.name?(a.editTask.factoryOperation=a.task.data.factoryOperation,a.$watch("editTask.poNo",function(a,b){null!==p&&clearTimeout(p),void 0===a||angular.equals(a,b)||(p=setTimeout(function(){g({method:"get",responseType:"json",url:n.serverLocation+n.poFuzzySearch.replace("#poNo#",a),data:"poFuzzySearch"}).then(i,j)},300))}),a.$watch("editTask.fuzzyPoNo",function(a,b){null!==p&&clearTimeout(p),void 0===a||angular.equals(a,b)||(p=setTimeout(function(){g({method:"get",responseType:"json",url:n.serverLocation+n.getPoUrl.replace("#poNo#",a),data:"getPoUrl"}).then(i,j)},300))}),a.$watch("editTask.poId",function(a,b){void 0===a||angular.equals(a,b)||(p=setTimeout(function(){g({method:"get",responseType:"json",url:n.serverLocation+n.getComboUrl.replace("#poId#",a),data:"getComboUrl"}).then(i,j)},300))}),a.$watch("editTask.comboId",function(a,b){null!==p&&clearTimeout(p),void 0===a||angular.equals(a,b)||(p=setTimeout(function(){g({method:"get",responseType:"json",url:n.serverLocation+n.getProductUrl.replace("#comboId#",a),data:"getProductUrl"}).then(i,j)},300))}),a.$watch("editTask.productId",function(b,c){return"object"==typeof b?!1:(null!==p&&clearTimeout(p),void(void 0===b||angular.equals(b,c)||(p=setTimeout(function(){g({method:"get",responseType:"json",url:n.serverLocation+n.getProcessUrl.replace("#productId#",b),data:"getProcessUrl",params:{factoryOperationCode:a.editTask.factoryOperation.code}}).then(i,j)},300))))})):a.editTask={};a.$watch("editTask.processId",function(b,c){if(a.editTask.previousOperation=[],a.editTask.nextOperation=[],!angular.equals(b,c)&&b in a.$parent.gantt.processesMap){var d=a.$parent.gantt.processesMap[b].tasks;for(k=0,l=d,m=l.length;m>k;++k)a.editTask.previousOperation.push({label:l[k].subject,value:l[k].id}),a.editTask.nextOperation.push({label:l[k].subject,value:l[k].id})}}),a.$watch("editTask.previousTask",function(b,c){if(a.editTask.nextOperation=[],!angular.equals(b,c)&&b in a.$parent.gantt.tasksMap){var d=a.$parent.gantt.processesMap[a.editTask.processId].tasks;for(k=0,l=d,m=l.length;m>k;++k)l[k].from>a.$parent.gantt.tasksMap[b].from&&a.editTask.nextOperation.push({label:l[k].subject,value:l[k].id})}}),a.$watch("editTask.previousTask+','+editTask.nextTask",function(b,c){if(!angular.equals(b,c)){var d=b.split(",");d.length>1&&void 0!==a.$parent.gantt.tasksMap[d[1]]&&void 0!==a.$parent.gantt.tasksMap[d[0]]&&a.shiftTaskPriority(a.$parent.gantt.tasksMap[d[0]])}})}]}}]),gantt.directive("ganttTaskInformation",["$window","$document","$timeout","dateFunctions","_",function(){var a="";return{restrict:"E",link:function(b){a=b.$parent.gantt.ajaxUrl.serverLocation+b.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"
},templateUrl:function(b,c){return void 0===c.templateUrl?a+"gantt.information.tmpl.html":a+c.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){var b=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.getMoreInformationPage.replace("#operationIds#",a.task.id);a.checkUrl=function(){$http({method:"get",url:b}).then(function(a){return console.log(a),b},function(a){return console.log(a),b})},a.gantt=a.$parent.gantt}]}}]),gantt.directive("ganttTaskOnProcessing",["$window","$document","$timeout",function(){var a="";return{restrict:"E",link:function(b){a=b.$parent.gantt.ajaxUrl.serverLocation+b.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(b,c){return void 0===c.templateUrl?a+"gantt.processingLightbox.tmpl.html":a+c.templateUrl},replace:!0,scope:{show:"=ngModel"},controller:["$scope","$element",function(){}]}}]),gantt.directive("ganttMachineTooltip",["$window","$document","$timeout","dateFunctions","_",function(a,b){var c="";return{restrict:"E",link:function(a){c=a.$parent.gantt.ajaxUrl.serverLocation+a.$parent.gantt.ajaxUrl.jsLocationPrefix+"template/"},templateUrl:function(a,b){return void 0===b.templateUrl?c+"gantt.tooltiponmachine.tmpl.html":c+b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){angular.element(b[0].body);a.css={opacity:1,"z-index":1e3,top:a.task.css.y+"px",left:a.task.css.x+"px"},a.taskTitle=a.task.title,a.taskInformation={head:a.task.header,data:a.task.data},a.editThisTask=function(a){a.task.gantt.tooltipTaskOnMachine=void 0,a.task.gantt.enableTaskEditor=a.task},a.showTaskJobFlow=function(a){a.task.gantt.tooltipTaskOnMachine=void 0,a.task.gantt.jobFlowChart=a.task.gantt.jobsMap[a.task.job.id]},a.showThisTaskInformation=function(a){a.task.gantt.tooltipTaskOnMachine=void 0,a.task.gantt.showTaskInformation=a.task},a.deleteThisTask=function(a){a.task.gantt.tooltipTaskOnMachine=void 0,confirm("Are you sure to delete this Task?")&&(a.task.dirty=!0,a.task.isDeleted=!0,a.task.isManual=!0,a.element.remove())},a.$watch("task",function(b,c){angular.equals(b,c)||(a.css={opacity:1,"z-index":1e3,top:b.css.y+"px",left:b.css.x+"px"},a.taskInformation={head:b.header,data:b.data},a.taskTitle=b.title)})}]}}]);